<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­ ÙˆØ§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    body {
      font-family: 'Cairo', Tahoma, sans-serif;
      background-color: #e9f0f7;
      padding: 25px;
      max-width: 1200px;
      margin: auto;
      color: #2c3e50;
    }
    h2, h3 {
      text-align: center;
      color: #1a5276;
      font-weight: 700;
      margin-bottom: 10px;
    }
    label {
      display: flex;
      align-items: center;
      font-weight: 600;
      margin-top: 18px;
      color: #154360;
      font-size: 17px;
      gap: 8px;
    }
    input, select {
      padding: 10px 12px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
      border: 2px solid #2980b9;
      border-radius: 6px;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #1f618d;
      background-color: #d6eaf8;
    }
    button {
      padding: 12px 25px;
      background: linear-gradient(45deg, #2e86c1, #2874a6);
      color: white;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(41, 128, 185, 0.3);
      transition: background 0.3s ease;
      min-width: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button:hover {
      background: linear-gradient(45deg, #1b4f72, #154360);
    }
    .btn-delete {
      background: linear-gradient(45deg, #c0392b, #a93226);
      padding: 8px 15px;
      min-width: 80px;
      margin: 0;
    }
    .btn-delete:hover {
      background: linear-gradient(45deg, #922b21, #78281f);
    }
    .btn-edit {
      background: linear-gradient(45deg, #f39c12, #e67e22);
      padding: 8px 15px;
      min-width: 80px;
      margin: 0;
    }
    .btn-edit:hover {
      background: linear-gradient(45deg, #d68910, #ca6f1e);
    }
    .buttons-row {
      display: flex;
      justify-content: flex-start;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .section {
      background: #fefefe;
      border-radius: 12px;
      padding: 25px 30px;
      margin-top: 30px;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.07);
      border: 1.5px solid #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
      background-color: white;
      direction: rtl;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 12px rgba(41, 128, 185, 0.2);
      font-size: 14px;
      user-select: none;
    }
    th, td {
      border: 1px solid #aed6f1;
      padding: 10px 8px;
      text-align: center;
      vertical-align: middle;
      transition: background-color 0.25s ease;
    }
    th {
      background-color: #2874a6;
      color: #ecf0f1;
      font-weight: 700;
      letter-spacing: 0.05em;
      user-select: none;
      font-size: 13px;
    }
    tr:nth-child(even) td {
      background-color: #f9fbfe;
    }
    tr:hover td {
      background-color: #d6eaf8;
    }
    footer {
      margin-top: 45px;
      text-align: center;
      font-size: 14px;
      color: #5d6d7e;
      font-style: italic;
      user-select: none;
    }
    .icon-sample-size::before { content: "ğŸ“Š"; }
    .icon-scale-type::before { content: "âš–ï¸"; }
    .icon-question-number::before { content: "â“"; }
    button svg, button .btn-icon {
      font-size: 18px;
    }
    #errorMessage, #infoMessage {
      padding: 12px 15px;
      margin-top: 15px;
      border-radius: 8px;
      font-weight: 600;
      display: none;
      user-select: none;
    }
    #errorMessage {
      color: #c0392b;
      background-color: #f9e6e6;
      border: 1px solid #e74c3c;
    }
    #infoMessage {
      color: #16a085;
      background-color: #d5f4e6;
      border: 1px solid #1abc9c;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      margin-right: 5px;
      color: #2980b9;
      font-weight: bold;
    }
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #34495e;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 13px;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .summary-card h4 {
      margin: 0 0 10px 0;
      font-size: 16px;
      opacity: 0.9;
    }
    .summary-card .value {
      font-size: 28px;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .action-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
  </style>
</head>
<body>
  <h2>Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>

  <div class="section">
    <label for="sampleSize" class="icon-sample-size">
      Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©:
      <span class="tooltip" data-tooltip="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†">â„¹ï¸</span>
    </label>
    <input type="number" id="sampleSize" placeholder="Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© 123" min="1" />

    <label for="scaleType" class="icon-scale-type">
      Ù†ÙˆØ¹ Ù…Ù‚ÙŠØ§Ø³ Ù„ÙŠÙƒØ±Øª:
      <span class="tooltip" data-tooltip="Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø«Ù†Ø§Ø¦ÙŠØŒ Ø«Ù„Ø§Ø«ÙŠØŒ Ø£Ùˆ Ø®Ù…Ø§Ø³ÙŠ)">â„¹ï¸</span>
    </label>
    <select id="scaleType">
      <option value="" selected>-- Ø§Ø®ØªØ± --</option>
      <option value="2">Ø«Ù†Ø§Ø¦ÙŠ</option>
      <option value="3">Ø«Ù„Ø§Ø«ÙŠ</option>
      <option value="5">Ø®Ù…Ø§Ø³ÙŠ</option>
    </select>

    <label for="questionNumber" class="icon-question-number">
      Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„:
      <span class="tooltip" data-tooltip="Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† (Ø³ÙŠØ²Ø¯Ø§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)">â„¹ï¸</span>
    </label>
    <input type="text" id="questionNumber" placeholder="Ù…Ø«Ø§Ù„: 1 Ø£Ùˆ 2 Ø£Ùˆ ..." />

    <div id="weightInputsContainer" class="section hidden"></div>
    <div id="inputsContainer" class="section hidden"></div>

    <button id="calculateQuestionBtn" title="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„">
      <span class="btn-icon">â•</span> <span id="btnText">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„</span>
    </button>

    <div id="errorMessage"></div>
    <div id="infoMessage"></div>
  </div>

  <div class="section" id="resultsSection">
    <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <table id="resultsTable" dir="rtl">
      <thead id="resultsTableHead"></thead>
      <tbody></tbody>
    </table>
    <div class="buttons-row">
      <button onclick="exportToWord()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Word">
        <span class="btn-icon">ğŸ“„</span> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word
      </button>
      <button id="resetBtn" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø©">
        <span class="btn-icon">ğŸ”„</span> Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
    </div>
  </div>

  <div class="section hidden" id="summarySection">
    <h3>ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <div class="summary-grid" id="summaryGrid"></div>
  </div>

  <footer>
    Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 - Ø¯. Ø·Ù„Ø§Ù„ Ù†Ø§Ø¸Ù… Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ
  </footer>

  <script>
    const scaleOptions = {
      2: ["Ù…ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
      3: ["Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
      5: ["Ù…ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©", "Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©"]
    };

    let fixedWeights = null;
    let questionsData = [];
    let editingIndex = -1;
    
    const inputsContainer = document.getElementById('inputsContainer');
    const weightInputsContainer = document.getElementById('weightInputsContainer');
    const scaleType = document.getElementById('scaleType');
    const questionNumberInput = document.getElementById('questionNumber');
    const sampleSizeInput = document.getElementById('sampleSize');
    const resultsTable = document.getElementById('resultsTable');
    const resultsBody = resultsTable.querySelector('tbody');
    const resultsTableHead = document.getElementById('resultsTableHead');
    const errorMessage = document.getElementById('errorMessage');
    const infoMessage = document.getElementById('infoMessage');
    const summarySection = document.getElementById('summarySection');
    const summaryGrid = document.getElementById('summaryGrid');
    const btnText = document.getElementById('btnText');

    function updateTableHeaders() {
      const scale = scaleOptions[scaleType.value];
      resultsTableHead.innerHTML = '';

      if (!scale) return;

      const headerRow = document.createElement('tr');

      ['Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„', 'Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });

      scale.forEach(label => {
        const th = document.createElement('th');
        th.textContent = label;
        headerRow.appendChild(th);
      });

      ['Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­', 'Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù', 'Ø§Ù„ØªØ¨Ø§ÙŠÙ†', 'Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù %', 'Ø§Ù„ÙˆØ³ÙŠØ·', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });

      resultsTableHead.appendChild(headerRow);
    }

    scaleType.addEventListener('change', () => {
      if (questionsData.length > 0) {
        showError('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.');
        scaleType.value = questionsData[0].scaleVal;
        return;
      }
      
      if (fixedWeights !== null) {
        showError('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø¹Ø¯ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ÙˆØ²Ø§Ù†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.');
        scaleType.value = scaleType.dataset.currentValue || '';
        return;
      }
      
      scaleType.dataset.currentValue = scaleType.value;
      hideMessages();
      updateTableHeaders();

      const scale = scaleOptions[scaleType.value];
      if (!scale) return;

      weightInputsContainer.innerHTML = '<h4 style="color: #154360; margin-top: 0;">Ø£ÙˆØ²Ø§Ù† Ø§Ù„ÙØ¦Ø§Øª:</h4>';
      scale.forEach((label, idx) => {
        const div = document.createElement('div');
        div.style.marginTop = '12px';
        const lbl = document.createElement('label');
        lbl.textContent = label + ':';
        lbl.style.marginTop = '5px';
        const input = document.createElement('input');
        input.type = 'number';
        input.step = 'any';
        input.placeholder = `Ø§Ù„ÙˆØ²Ù† Ù„Ù€: ${label}`;
        input.dataset.index = idx;
        input.value = scale.length - idx;
        div.appendChild(lbl);
        div.appendChild(input);
        weightInputsContainer.appendChild(div);
      });
      weightInputsContainer.classList.remove('hidden');

      inputsContainer.innerHTML = '<h4 style="color: #154360; margin-top: 0;">ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:</h4>';
      scale.forEach(label => {
        const div = document.createElement('div');
        div.style.marginTop = '12px';
        const lbl = document.createElement('label');
        lbl.textContent = label + ':';
        lbl.style.marginTop = '5px';
        const input = document.createElement('input');
        input.type = 'number';
        input.min = 0;
        input.placeholder = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª: ${label}`;
        div.appendChild(lbl);
        div.appendChild(input);
        inputsContainer.appendChild(div);
      });
      inputsContainer.classList.remove('hidden');
      
      showInfo('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©.');
    });

    document.getElementById('calculateQuestionBtn').addEventListener('click', () => {
      hideMessages();
      
      const questionNum = questionNumberInput.value.trim();
      const sampleSize = parseInt(sampleSizeInput.value.trim());
      const scaleVal = scaleType.value;

      if (!questionNum) {
        showError("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„.");
        return;
      }
      if (!sampleSize || sampleSize <= 0) {
        showError("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø¬Ù… Ø¹ÙŠÙ†Ø© ØµØ­ÙŠØ­.");
        return;
      }
      if (!scaleVal) {
        showError("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³.");
        return;
      }

      const countInputs = inputsContainer.querySelectorAll('input');
      const weightInputs = weightInputsContainer.querySelectorAll('input');

      if (!fixedWeights) {
        fixedWeights = Array.from(weightInputs).map(input => parseFloat(input.value || '0'));
        if (fixedWeights.some(isNaN)) {
          showError("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ÙƒÙ„ ÙØ¦Ø©.");
          return;
        }
        Array.from(weightInputs).forEach(input => input.disabled = true);
        sampleSizeInput.disabled = true;
        scaleType.disabled = true;
        showInfo('âœ“ ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙˆØ­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.');
      }

      const counts = Array.from(countInputs).map(input => parseInt(input.value || '0'));
      if (counts.reduce((a, b) => a + b, 0) === 0) {
        showError("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª.");
        return;
      }

      const total = counts.reduce((a, b) => a + b, 0);

      if (total !== sampleSize) {
        showError(`âŒ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¬ÙˆØ¨Ø© (${total}) Ù„Ø§ ÙŠØ³Ø§ÙˆÙŠ Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© (${sampleSize}). ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ….`);
        return;
      }

      const stats = calculateStatistics(counts, fixedWeights);

      const questionData = {
        questionNum,
        sampleSize,
        scaleVal,
        counts: [...counts],
        stats
      };

      if (editingIndex >= 0) {
        questionsData[editingIndex] = questionData;
        editingIndex = -1;
        btnText.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„';
        showInfo('âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
      } else {
        questionsData.push(questionData);
        questionNumberInput.value = parseInt(questionNum) + 1;
        showInfo('âœ“ ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
      }

      renderTable();
      updateSummary();
      resetInputFields();
    });

    function calculateStatistics(counts, weights) {
      const total = counts.reduce((a, b) => a + b, 0);
      
      const weightedSum = counts.reduce((sum, c, i) => sum + c * weights[i], 0);
      const mean = weightedSum / total;

      let variance = 0;
      for (let i = 0; i < counts.length; i++) {
        variance += counts[i] * Math.pow(weights[i] - mean, 2);
      }
      variance = variance / total;
      const std = Math.sqrt(variance);

      // Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (CV)
      const cv = mean !== 0 ? (std / mean) * 100 : 0;

      const valuesArray = [];
      for (let i = 0; i < counts.length; i++) {
        for (let j = 0; j < counts[i]; j++) {
          valuesArray.push(weights[i]);
        }
      }
      valuesArray.sort((a, b) => a - b);
      
      const median = valuesArray.length % 2 === 0
        ? (valuesArray[valuesArray.length / 2 - 1] + valuesArray[valuesArray.length / 2]) / 2
        : valuesArray[Math.floor(valuesArray.length / 2)];

      return { mean, std, variance, cv, median };
    }

    function renderTable() {
      resultsBody.innerHTML = '';
      questionsData.forEach((data, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${data.questionNum}</td>
          <td>${data.sampleSize}</td>
          <td>${data.scaleVal}</td>
          ${data.counts.map(c => `<td>${c}</td>`).join('')}
          <td>${data.stats.mean.toFixed(2)}</td>
          <td>${data.stats.std.toFixed(2)}</td>
          <td>${data.stats.variance.toFixed(2)}</td>
          <td>${data.stats.cv.toFixed(2)}</td>
          <td>${data.stats.median.toFixed(2)}</td>
          <td class="action-buttons">
            <button class="btn-edit" onclick="editQuestion(${index})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„">âœï¸</button>
            <button class="btn-delete" onclick="deleteQuestion(${index})" title="Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„">ğŸ—‘ï¸</button>
          </td>
        `;
        resultsBody.appendChild(row);
      });
    }

    function updateSummary() {
      if (questionsData.length === 0) {
        summarySection.classList.add('hidden');
        return;
      }

      summarySection.classList.remove('hidden');
      
      const avgMean = questionsData.reduce((sum, q) => sum + q.stats.mean, 0) / questionsData.length;
      const avgStd = questionsData.reduce((sum, q) => sum + q.stats.std, 0) / questionsData.length;
      const avgVariance = questionsData.reduce((sum, q) => sum + q.stats.variance, 0) / questionsData.length;
      const avgCV = questionsData.reduce((sum, q) => sum + q.stats.cv, 0) / questionsData.length;
      const avgMedian = questionsData.reduce((sum, q) => sum + q.stats.median, 0) / questionsData.length;
      const maxMean = Math.max(...questionsData.map(q => q.stats.mean));
      const minMean = Math.min(...questionsData.map(q => q.stats.mean));

      summaryGrid.innerHTML = `
        <div class="summary-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h4>
          <div class="value">${questionsData.length}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­</h4>
          <div class="value">${avgMean.toFixed(2)}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ</h4>
          <div class="value">${avgStd.toFixed(2)}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ¨Ø§ÙŠÙ†</h4>
          <div class="value">${avgVariance.toFixed(2)}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
          <h4>Ù…ØªÙˆØ³Ø· Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù</h4>
          <div class="value">${avgCV.toFixed(2)}%</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
          <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³ÙŠØ·</h4>
          <div class="value">${avgMedian.toFixed(2)}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
          <h4>Ø£Ø¹Ù„Ù‰ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</h4>
          <div class="value">${maxMean.toFixed(2)}</div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
          <h4>Ø£Ù‚Ù„ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</h4>
          <div class="value">${minMean.toFixed(2)}</div>
        </div>
      `;
    }

    function resetInputFields() {
      const countInputs = inputsContainer.querySelectorAll('input');
      countInputs.forEach(input => input.value = '');
    }

    window.editQuestion = function(index) {
      const data = questionsData[index];
      questionNumberInput.value = data.questionNum;
      
      const countInputs = inputsContainer.querySelectorAll('input');
      data.counts.forEach((count, i) => {
        countInputs[i].value = count;
      });
      
      editingIndex = index;
      btnText.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„';
      showInfo('ğŸ’¡ Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„"');
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.deleteQuestion = function(index) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
        questionsData.splice(index, 1);
        renderTable();
        updateSummary();
        showInfo('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
        
        if (questionsData.length === 0) {
          resetAll();
        }
      }
    };

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      infoMessage.style.display = 'none';
    }

    function showInfo(message) {
      infoMessage.textContent = message;
      infoMessage.style.display = 'block';
      errorMessage.style.display = 'none';
      setTimeout(() => {
        infoMessage.style.display = 'none';
      }, 5000);
    }

    function hideMessages() {
      errorMessage.style.display = 'none';
      infoMessage.style.display = 'none';
    }

    function resetAll() {
      fixedWeights = null;
      questionsData = [];
      editingIndex = -1;
      sampleSizeInput.disabled = false;
      scaleType.disabled = false;
      weightInputsContainer.innerHTML = '';
      inputsContainer.innerHTML = '';
      questionNumberInput.value = '';
      sampleSizeInput.value = '';
      scaleType.value = '';
      resultsBody.innerHTML = '';
      resultsTableHead.innerHTML = '';
      weightInputsContainer.classList.add('hidden');
      inputsContainer.classList.add('hidden');
      summarySection.classList.add('hidden');
      btnText.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„';
      scaleType.dataset.currentValue = '';
      hideMessages();
    }

    document.getElementById('resetBtn').addEventListener('click', () => {
      if (questionsData.length > 0 && !confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ')) {
        return;
      }
      resetAll();
      showInfo('âœ“ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    });

    function generateAnalyticalText(avgMean, avgStd, avgVariance, avgCV, avgMedian, maxMean, minMean, totalQuestions) {
      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­
      let agreementLevel = '';
      let agreementDescription = '';
      if (avgMean >= 4) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹';
        agreementDescription = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ ÙˆÙ‚Ø¨ÙˆÙ„ ÙˆØ§Ø³Ø¹ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else if (avgMean >= 3.5) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø§Ù„ÙŠØ©';
        agreementDescription = 'ØªØ¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡Ø§Ù‹ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Ù‹ Ù…Ù„Ø­ÙˆØ¸Ø§Ù‹ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else if (avgMean >= 3) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ù…ØªÙˆØ³Ø·Ø©';
        agreementDescription = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ù…Ø­Ø§ÙŠØ¯ ÙŠÙ…ÙŠÙ„ Ù†Ø­Ùˆ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©';
      } else if (avgMean >= 2.5) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù†Ø®ÙØ¶Ø©';
        agreementDescription = 'ØªØ¹ÙƒØ³ ØªØ­ÙØ¸Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else {
        agreementLevel = 'Ø¹Ø¯Ù… Ù…ÙˆØ§ÙÙ‚Ø©';
        agreementDescription = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø³Ù„Ø¨ÙŠ ÙˆØ§Ø¶Ø­ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      }

      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¬Ø§Ù†Ø³ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ
      let homogeneityLevel = '';
      let homogeneityDescription = '';
      if (avgStd < 0.5) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ø¹Ø§Ù„Ù Ø¬Ø¯Ø§Ù‹';
        homogeneityDescription = 'Ù…Ù…Ø§ ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ø¹ Ù‚ÙˆÙŠ ÙˆØªØ·Ø§Ø¨Ù‚ ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡';
      } else if (avgStd < 1.0) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ø¬ÙŠØ¯';
        homogeneityDescription = 'ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ³Ø§Ù‚ Ù…Ù„Ø­ÙˆØ¸ ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø¹ ØªØ¨Ø§ÙŠÙ† Ù…Ø­Ø¯ÙˆØ¯';
      } else if (avgStd < 1.5) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ù…ØªÙˆØ³Ø·';
        homogeneityDescription = 'ÙŠØ¹ÙƒØ³ ÙˆØ¬ÙˆØ¯ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ¨Ø§ÙŠÙ† ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡ Ø¯ÙˆÙ† ØªØ´ØªØª ÙƒØ¨ÙŠØ±';
      } else {
        homogeneityLevel = 'ØªØ¨Ø§ÙŠÙ† Ù…Ù„Ø­ÙˆØ¸';
        homogeneityDescription = 'ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ø®ØªÙ„Ø§Ù ÙˆØ§Ø¶Ø­ ÙÙŠ ÙˆØ¬Ù‡Ø§Øª Ù†Ø¸Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      }

      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù
      let consistencyLevel = '';
      let consistencyDescription = '';
      if (avgCV < 15) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ù…Ù…ØªØ§Ø²';
        consistencyDescription = 'ÙˆÙ‡Ùˆ Ø¶Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©';
      } else if (avgCV < 25) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ø¬ÙŠØ¯';
        consistencyDescription = 'ÙˆÙ‡Ùˆ Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ù„Ø¨Ø­ÙˆØ« Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©';
      } else if (avgCV < 35) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ù…Ù‚Ø¨ÙˆÙ„';
        consistencyDescription = 'Ù…Ø¹ ÙˆØ¬ÙˆØ¯ ØªÙ†ÙˆØ¹ Ù…Ø¹ØªØ¯Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª';
      } else {
        consistencyLevel = 'ØªÙ†ÙˆØ¹ ÙƒØ¨ÙŠØ±';
        consistencyDescription = 'Ù…Ù…Ø§ ÙŠØ³ØªØ¯Ø¹ÙŠ ÙØ­ØµØ§Ù‹ Ø£Ø¹Ù…Ù‚ Ù„Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø©';
      }

      // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ
      let analysisText = `
        <div style="margin: 30px 20px; padding: 25px; background-color: #f8f9fa; border-right: 5px solid #2874a6; line-height: 2; text-align: justify; direction: rtl;">
          <h3 style="color: #1a5276; margin-bottom: 20px; text-align: center;">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙˆØ¹ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬</h3>
          
          <p style="margin-bottom: 15px; font-size: 15px;">
            <strong>Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ù†Ø¸Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</strong><br/>
            Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ù€ <strong>(${totalQuestions})</strong> Ø³Ø¤Ø§Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†ØŒ 
            Ø£Ø¸Ù‡Ø±Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­ Ø¨Ù„Øº <strong>(${avgMean.toFixed(2)})</strong> 
            Ù…Ù…Ø§ ÙŠØ¹ÙƒØ³ Ù…Ø³ØªÙˆÙ‰ <strong>${agreementLevel}</strong> Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†ØŒ ${agreementDescription}.
          </p>

          <p style="margin-bottom: 15px; font-size: 15px;">
            <strong>Ø«Ø§Ù†ÙŠØ§Ù‹: ØªØ¬Ø§Ù†Ø³ Ø§Ù„Ø¢Ø±Ø§Ø¡</strong><br/>
            Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ <strong>(${avgStd.toFixed(2)})</strong> ÙˆÙ‡Ùˆ Ù…Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ 
            <strong>${homogeneityLevel}</strong> ${homogeneityDescription}. 
            ÙƒÙ…Ø§ Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ¨Ø§ÙŠÙ† <strong>(${avgVariance.toFixed(2)})</strong> 
            Ù…Ù…Ø§ ÙŠØ¤ÙƒØ¯ Ù‡Ø°Ø§ Ø§Ù„ØªÙˆØ¬Ù‡ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
          </p>

          <p style="margin-bottom: 15px; font-size: 15px;">
            <strong>Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§ØªØ³Ø§Ù‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª</strong><br/>
            Ø³Ø¬Ù„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ù…ØªÙˆØ³Ø·Ø§Ù‹ Ù‚Ø¯Ø±Ù‡ <strong>(${avgCV.toFixed(2)}%)</strong> ÙˆÙ‡Ùˆ ÙŠÙ…Ø«Ù„ 
            <strong>${consistencyLevel}</strong> ${consistencyDescription}. 
            Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¤Ø´Ø± ÙŠØ¹ØªØ¨Ø± Ù…Ù‚ÙŠØ§Ø³Ø§Ù‹ Ù†Ø³Ø¨ÙŠØ§Ù‹ Ù…Ù‡Ù…Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©.
          </p>

          <p style="margin-bottom: 15px; font-size: 15px;">
            <strong>Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ØªØ¨Ø§ÙŠÙ†</strong><br/>
            ØªØ±Ø§ÙˆØ­Øª Ù‚ÙŠÙ… Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­ Ø¨ÙŠÙ† <strong>(${minMean.toFixed(2)})</strong> 
            ÙƒØ£Ø¯Ù†Ù‰ Ù‚ÙŠÙ…Ø© Ùˆ<strong>(${maxMean.toFixed(2)})</strong> ÙƒØ£Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø©ØŒ 
            Ù…Ù…Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ ${maxMean - minMean < 1 ? 'ØªÙ‚Ø§Ø±Ø¨ ÙƒØ¨ÙŠØ±' : maxMean - minMean < 2 ? 'ØªØ¨Ø§ÙŠÙ† Ù…Ø¹ØªØ¯Ù„' : 'ØªØ¨Ø§ÙŠÙ† Ù…Ù„Ø­ÙˆØ¸'} 
            ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø¹Ø¨Ø± Ù…Ø®ØªÙ„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. 
            ${avgMedian ? `ÙƒÙ…Ø§ Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³ÙŠØ· <strong>(${avgMedian.toFixed(2)})</strong> ÙˆÙ‡Ùˆ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØŒ 
            Ù…Ù…Ø§ ÙŠØ¹Ø²Ø² Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„.` : ''}
          </p>

          <p style="margin-bottom: 0; font-size: 15px;">
            <strong>Ø§Ù„Ø®Ù„Ø§ØµØ©:</strong><br/>
            ØªØ´ÙŠØ± Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ø¥Ù„Ù‰ ${avgMean >= 3.5 && avgCV < 25 ? 
            'Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…ØªØ³Ù‚Ø© ØªØ¹ÙƒØ³ ÙˆØ¶ÙˆØ­Ø§Ù‹ ÙÙŠ ØªÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙˆØ§ØªØ³Ø§Ù‚Ø§Ù‹ ÙÙŠ Ø¢Ø±Ø§Ø¦Ù‡Ù…' : 
            avgMean >= 3 ? 'Ù†ØªØ§Ø¦Ø¬ Ù…Ù‚Ø¨ÙˆÙ„Ø© Ù…Ø¹ ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ø§Ù„ Ù„Ù„ØªØ­Ø³ÙŠÙ† ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø­Ø§ÙˆØ±' :
            'Ù†ØªØ§Ø¦Ø¬ ØªØ³ØªØ¯Ø¹ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø± ÙÙŠ Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©'}.
            ${avgCV > 30 ? ' ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø£Ø¹Ù…Ù‚ Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø°Ø§Øª Ø§Ù„ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ù„ÙŠ Ù„ÙÙ‡Ù… Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡.' : ''}
          </p>
        </div>
      `;

      return analysisText;
    }

    function exportToWord() {
      if (!resultsBody.hasChildNodes()) {
        showError("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");
        return;
      }
      hideMessages();
      
      let summaryHTML = '';
      let analyticalText = '';
      
      if (questionsData.length > 0) {
        const avgMean = questionsData.reduce((sum, q) => sum + q.stats.mean, 0) / questionsData.length;
        const avgStd = questionsData.reduce((sum, q) => sum + q.stats.std, 0) / questionsData.length;
        const avgVariance = questionsData.reduce((sum, q) => sum + q.stats.variance, 0) / questionsData.length;
        const avgCV = questionsData.reduce((sum, q) => sum + q.stats.cv, 0) / questionsData.length;
        const avgMedian = questionsData.reduce((sum, q) => sum + q.stats.median, 0) / questionsData.length;
        const maxMean = Math.max(...questionsData.map(q => q.stats.mean));
        const minMean = Math.min(...questionsData.map(q => q.stats.mean));
        
        summaryHTML = `
          <h3 style="text-align: center; margin-top: 30px;">Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…</h3>
          <table border="1" style="width: 60%; margin: 20px auto; border-collapse: collapse;">
            <tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>
            <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</td><td>${questionsData.length}</td></tr>
            <tr><td>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­</td><td>${avgMean.toFixed(2)}</td></tr>
            <tr><td>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ</td><td>${avgStd.toFixed(2)}</td></tr>
            <tr><td>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ¨Ø§ÙŠÙ†</td><td>${avgVariance.toFixed(2)}</td></tr>
            <tr><td>Ù…ØªÙˆØ³Ø· Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù</td><td>${avgCV.toFixed(2)}%</td></tr>
            <tr><td>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³ÙŠØ·</td><td>${avgMedian.toFixed(2)}</td></tr>
            <tr><td>Ø£Ø¹Ù„Ù‰ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</td><td>${maxMean.toFixed(2)}</td></tr>
            <tr><td>Ø£Ù‚Ù„ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</td><td>${minMean.toFixed(2)}</td></tr>
          </table>
        `;
        
        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ
        analyticalText = generateAnalyticalText(avgMean, avgStd, avgVariance, avgCV, avgMedian, maxMean, minMean, questionsData.length);
      }
      
      let html = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' 
          xmlns:w='urn:schemas-microsoft-com:office:word' 
          xmlns='http://www.w3.org/TR/REC-html40'>
          <head>
            <meta charset="utf-8">
            <title>ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word</title>
            <style>
              table { border-collapse: collapse; width: 100%; direction: rtl; }
              th, td { border: 1px solid black; padding: 8px; text-align: center; }
              th { background-color: #2874a6; color: white; }
            </style>
          </head>
          <body>
            <h2 style="text-align: center;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</h2>
            ${resultsTable.outerHTML}
            ${summaryHTML}
            ${analyticalText}
          </body>
        </html>`;
      const blob = new Blob(['\ufeff', html], {type: 'application/msword'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø£Ø³Ø¦Ù„Ø©_Ø§Ù„Ù…Ø­Ø³Ù†Ø©.doc';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
      showInfo('âœ“ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
    }
  </script>
</body>
</html>
