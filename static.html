<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø¯Ø§Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    
    :root {
      --primary-color: #2874a6;
      --primary-dark: #1a5276;
      --secondary-color: #2980b9;
      --success-color: #16a085;
      --error-color: #c0392b;
      --warning-color: #f39c12;
      --bg-light: #e9f0f7;
      --bg-white: #fefefe;
      --text-dark: #2c3e50;
      --border-color: #aed6f1;
      --shadow-sm: 0 4px 8px rgba(41, 128, 185, 0.2);
      --shadow-md: 0 6px 12px rgba(41, 128, 185, 0.25);
      --shadow-lg: 0 8px 15px rgba(0, 0, 0, 0.07);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Cairo', Tahoma, sans-serif;
      background-color: var(--bg-light);
      padding: 25px;
      max-width: 1400px;
      margin: auto;
      color: var(--text-dark);
      line-height: 1.6;
    }
    
    .main-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
    }
    
    .main-header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .main-header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    h2, h3 {
      color: var(--primary-dark);
      font-weight: 700;
      margin-bottom: 15px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: flex;
      align-items: center;
      font-weight: 600;
      margin-bottom: 8px;
      color: #154360;
      font-size: 16px;
      gap: 8px;
    }
    
    input, select {
      padding: 12px 15px;
      font-size: 16px;
      font-family: 'Cairo', Tahoma, sans-serif;
      width: 100%;
      border: 2px solid var(--secondary-color);
      border-radius: 8px;
      outline: none;
      transition: all 0.3s ease;
      background-color: white;
    }
    
    input:focus, select:focus {
      border-color: var(--primary-dark);
      background-color: #d6eaf8;
      box-shadow: 0 0 0 3px rgba(26, 82, 118, 0.1);
    }
    
    input:disabled, select:disabled {
      background-color: #ecf0f1;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
	  
    }
    
    button {
      padding: 12px 28px;
      background: linear-gradient(45deg, #2e86c1, var(--primary-color));
      color: white;
      font-weight: 700;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      min-width: 140px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-family: 'Cairo', Tahoma, sans-serif;
    }
    
    button:hover:not(:disabled) {
      background: linear-gradient(45deg, #1b4f72, #154360);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(41, 128, 185, 0.4);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-delete {
      background: linear-gradient(45deg, #c0392b, #a93226);
      padding: 8px 15px;
      min-width: 80px;
      margin: 0;
    }
    
    .btn-delete:hover:not(:disabled) {
      background: linear-gradient(45deg, #922b21, #78281f);
    }
    
    .btn-edit {
      background: linear-gradient(45deg, #f39c12, #e67e22);
      padding: 8px 15px;
      min-width: 80px;
      margin: 0;
    }
    
    .btn-edit:hover:not(:disabled) {
      background: linear-gradient(45deg, #d68910, #ca6f1e);
    }
    
    .btn-secondary {
      background: linear-gradient(45deg, #7f8c8d, #95a5a6);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: linear-gradient(45deg, #5d6d7e, #707b7c);
    }
    
    .buttons-row {
      display: flex;
      justify-content: flex-start;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .section {
      background: var(--bg-white);
      border-radius: 12px;
      padding: 25px 30px;
      margin-top: 25px;
      box-shadow: var(--shadow-lg);
      border: 1.5px solid var(--secondary-color);
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
      background-color: white;
      direction: rtl;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      font-size: 14px;
    }
    
    th, td {
      border: 1px solid var(--border-color);
      padding: 12px 10px;
      text-align: center;
      vertical-align: middle;
      transition: background-color 0.2s ease;
    }
    
    th {
      background-color: var(--primary-color);
      color: #ecf0f1;
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 14px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    tr:nth-child(even) td {
      background-color: #f9fbfe;
    }
    
    tr:hover td {
      background-color: #d6eaf8;
    }
    
    .summary-row {
      background-color: #fef9e7 !important;
      font-weight: 700;
      color: var(--primary-dark);
    }
    
    .summary-row td {
      background-color: #fef9e7 !important;
      border-top: 3px solid var(--warning-color);
    }
    
    /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© - Ù„Ø§ */
    .action-column {
      /* ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© */
    }
    
    footer {
      margin-top: 50px;
      text-align: center;
      font-size: 14px;
      color: #5d6d7e;
      padding: 20px;
      border-top: 2px solid var(--border-color);
    }
    
    .alert {
      padding: 15px 20px;
      margin-top: 15px;
      border-radius: 8px;
      font-weight: 600;
      display: none;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .alert-error {
      color: #7b241c;
      background-color: #f9e6e6;
      border: 1px solid var(--error-color);
      border-right: 4px solid var(--error-color);
    }
    
    .alert-success {
      color: #0e6655;
      background-color: #d5f4e6;
      border: 1px solid var(--success-color);
      border-right: 4px solid var(--success-color);
    }
    
    .alert-warning {
      color: #7d6608;
      background-color: #fcf3cf;
      border: 1px solid var(--warning-color);
      border-right: 4px solid var(--warning-color);
    }
    
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      color: var(--secondary-color);
      font-weight: bold;
      font-size: 16px;
    }
    
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #34495e;
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      white-space: nowrap;
      font-size: 13px;
      font-weight: normal;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .tooltip:hover::before {
      content: '';
      position: absolute;
      bottom: 115%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #34495e;
      z-index: 1000;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: var(--shadow-md);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .summary-card h4 {
      margin: 0 0 12px 0;
      font-size: 15px;
      opacity: 0.95;
      font-weight: 600;
    }
    
    .summary-card .value {
      font-size: 32px;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .hidden {
      display: none !important;
    }
    
    .action-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .note-box {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-right: 4px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-size: 14px;
      color: #856404;
      line-height: 1.6;
    }
    
    .note-box strong {
      display: block;
      margin-bottom: 5px;
      font-size: 15px;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background-color: #ecf0f1;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success-color), #1abc9c);
      transition: width 0.3s ease;
      border-radius: 10px;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 5px;
    }
    
    .badge-primary {
      background-color: #d6eaf8;
      color: var(--primary-dark);
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .main-header h1 {
        font-size: 22px;
      }
      
      .section {
        padding: 20px;
      }
      
      table {
        font-size: 12px;
      }
      
      th, td {
        padding: 8px 6px;
      }
      
      .summary-card .value {
        font-size: 24px;
      }
      
      .buttons-row {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
    }
    
    /* Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© - Ø¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
    @media print {
      /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ØºÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© */
      .section:not(#resultsSection):not(#summarySection),
      .buttons-row,
      footer {
        display: none !important;
      }
      
      body {
        background: white;
        padding: 10px;
      }
      
      .main-header {
        background: white !important;
        color: black !important;
        box-shadow: none;
        border: 2px solid #000;
      }
      
      /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙ…Ø§Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      #resultsTable thead tr th.action-column,
      #resultsTable tbody tr td.action-column {
        display: none !important;
      }
      
      /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      table {
        page-break-inside: auto;
        border: 2px solid #000;
      }
      
      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
      
      thead {
        display: table-header-group;
      }
      
      /* Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø¨ÙˆØ¶ÙˆØ­ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      th, td {
        border: 1px solid #000 !important;
        padding: 8px !important;
      }
      
      th {
        background-color: #2874a6 !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .summary-row td {
        background-color: #fef9e7 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="main-header">
    <h1>ğŸ¯ Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
    <p>ØªØ­Ù„ÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚ÙŠØ§Ø³ Ù„ÙŠÙƒØ±Øª Ù…Ø¹ Ù…Ø¤Ø´Ø±Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø´Ø§Ù…Ù„Ø©</p>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
  <div class="section">
    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</h3>
    
    <div class="grid-2">
      <div class="form-group">
        <label for="sampleSize">
          ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©:
          <span class="tooltip" data-tooltip="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†">â„¹ï¸</span>
        </label>
        <input type="number" id="sampleSize" placeholder="Ù…Ø«Ø§Ù„: 100" min="1" />
      </div>

      <div class="form-group">
        <label for="scaleType">
          âš–ï¸ Ù†ÙˆØ¹ Ù…Ù‚ÙŠØ§Ø³ Ù„ÙŠÙƒØ±Øª:
          <span class="tooltip" data-tooltip="Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©">â„¹ï¸</span>
        </label>
        <select id="scaleType">
          <option value="" selected>-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ --</option>
          <option value="2">Ø«Ù†Ø§Ø¦ÙŠ (Ù…ÙˆØ§ÙÙ‚ / Ù„Ø§ Ø£ÙˆØ§ÙÙ‚)</option>
          <option value="3">Ø«Ù„Ø§Ø«ÙŠ (Ù…ÙˆØ§ÙÙ‚ / Ù…Ø­Ø§ÙŠØ¯ / Ù„Ø§ Ø£ÙˆØ§ÙÙ‚)</option>
          <option value="5">Ø®Ù…Ø§Ø³ÙŠ (Ù…ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø© ... Ù„Ø§ Ø£ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©)</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="questionNumber">
        â“ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„:
        <span class="tooltip" data-tooltip="Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† (Ø³ÙŠØ²Ø¯Ø§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)">â„¹ï¸</span>
      </label>
      <input type="text" id="questionNumber" placeholder="Ù…Ø«Ø§Ù„: 1" />
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙˆØ²Ø§Ù† -->
    <div id="weightInputsContainer" class="hidden"></div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª -->
    <div id="inputsContainer" class="hidden"></div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
    <div class="buttons-row">
      <button id="calculateQuestionBtn" title="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ù„Ø¬Ø¯ÙˆÙ„">
        <span>â•</span>
        <span id="btnText">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„</span>
      </button>
      
      <button id="saveDataBtn" class="btn-secondary hidden" title="Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹">
        <span>ğŸ’¾</span>
        <span>Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
      </button>
      
      <button id="loadDataBtn" class="btn-secondary hidden" title="Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©">
        <span>ğŸ“‚</span>
        <span>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
      </button>
    </div>

    <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
    <div id="errorMessage" class="alert alert-error"></div>
    <div id="successMessage" class="alert alert-success"></div>
    <div id="warningMessage" class="alert alert-warning"></div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="section" id="resultsSection">
    <h3>ğŸ“‹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <div id="questionsCount" style="margin-bottom: 15px; color: #5d6d7e;"></div>
    
    <div style="overflow-x: auto;">
      <table id="resultsTable" dir="rtl">
        <thead id="resultsTableHead"></thead>
        <tbody></tbody>
      </table>
    </div>
    
    <div class="buttons-row">
      <button onclick="exportToWord()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Word">
        <span>ğŸ“„</span>
        <span>ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word</span>
      </button>
      
      <button onclick="exportToExcel()" title="ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel">
        <span>ğŸ“Š</span>
        <span>ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</span>
      </button>
      
      <button onclick="printResults()" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬">
        <span>ğŸ–¨ï¸</span>
        <span>Ø·Ø¨Ø§Ø¹Ø©</span>
      </button>
      
      <button id="resetBtn" class="btn-delete" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø©">
        <span>ğŸ”„</span>
        <span>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
      </button>
    </div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… -->
  <div class="section hidden" id="summarySection">
    <h3>ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <div class="summary-grid" id="summaryGrid"></div>
    
    <!-- Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ -->
    <div id="analyticalText" style="margin-top: 30px;"></div>
  </div>

  <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <footer>
    <p><strong>Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</strong></p>
    <p>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 - Ø¯. Ø·Ù„Ø§Ù„ Ù†Ø§Ø¸Ù… Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ</p>
    <p style="font-size: 12px; margin-top: 10px; color: #7f8c8d;">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© 2.1</p>
  </footer>

  <script>
    'use strict';
    
    // ============================================
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø«ÙˆØ§Ø¨Øª
    // ============================================
    
    const CONFIG = {
      scaleOptions: {
        2: ["Ù…ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
        3: ["Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
        5: ["Ù…ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©", "Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©"]
      },
      defaultWeights: {
        2: [2, 1],
        3: [3, 2, 1],
        5: [5, 4, 3, 2, 1]
      },
      storageKey: 'statisticalToolData',
      messageTimeout: 5000
    };

    // ============================================
    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    // ============================================
    
    let fixedWeights = null;
    let questionsData = [];
    let editingIndex = -1;
    
    // ============================================
    // Ø¹Ù†Ø§ØµØ± DOM
    // ============================================
    
    const elements = {
      sampleSize: document.getElementById('sampleSize'),
      scaleType: document.getElementById('scaleType'),
      questionNumber: document.getElementById('questionNumber'),
      weightInputsContainer: document.getElementById('weightInputsContainer'),
      inputsContainer: document.getElementById('inputsContainer'),
      resultsTable: document.getElementById('resultsTable'),
      resultsBody: document.querySelector('#resultsTable tbody'),
      resultsTableHead: document.getElementById('resultsTableHead'),
      errorMessage: document.getElementById('errorMessage'),
      successMessage: document.getElementById('successMessage'),
      warningMessage: document.getElementById('warningMessage'),
      summarySection: document.getElementById('summarySection'),
      summaryGrid: document.getElementById('summaryGrid'),
      analyticalText: document.getElementById('analyticalText'),
      btnText: document.getElementById('btnText'),
      calculateBtn: document.getElementById('calculateQuestionBtn'),
      resetBtn: document.getElementById('resetBtn'),
      saveDataBtn: document.getElementById('saveDataBtn'),
      loadDataBtn: document.getElementById('loadDataBtn'),
      questionsCount: document.getElementById('questionsCount')
    };

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Utility Functions)
    // ============================================
    
    /**
     * Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
     */
    function showMessage(message, type = 'success') {
      hideAllMessages();
      
      const messageMap = {
        error: elements.errorMessage,
        success: elements.successMessage,
        warning: elements.warningMessage
      };
      
      const messageElement = messageMap[type];
      if (messageElement) {
        messageElement.textContent = message;
        messageElement.style.display = 'block';
        
        if (type === 'success') {
          setTimeout(() => {
            messageElement.style.display = 'none';
          }, CONFIG.messageTimeout);
        }
      }
    }
    
    function hideAllMessages() {
      elements.errorMessage.style.display = 'none';
      elements.successMessage.style.display = 'none';
      elements.warningMessage.style.display = 'none';
    }
    
    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
     */
    function validateInputs(questionNum, sampleSize, scaleVal) {
      if (!questionNum.trim()) {
        showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„.", 'error');
        return false;
      }
      
      if (!sampleSize || sampleSize <= 0) {
        showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø¬Ù… Ø¹ÙŠÙ†Ø© ØµØ­ÙŠØ­ (Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±).", 'error');
        return false;
      }
      
      if (!scaleVal) {
        showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³.", 'error');
        return false;
      }
      
      return true;
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
     */
    function updateQuestionsCount() {
      const count = questionsData.length;
      if (count > 0) {
        elements.questionsCount.innerHTML = `
          <span class="badge badge-primary">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${count}</span>
          ${fixedWeights ? `<span class="badge badge-primary">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³: ${elements.scaleType.value} Ù†Ù‚Ø§Ø·</span>` : ''}
          ${fixedWeights ? `<span class="badge badge-primary">Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©: ${elements.sampleSize.value}</span>` : ''}
        `;
      } else {
        elements.questionsCount.innerHTML = '';
      }
    }
    
    /**
     * Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
     */
    function saveDataLocally() {
      try {
        const data = {
          questionsData,
          fixedWeights,
          sampleSize: elements.sampleSize.value,
          scaleType: elements.scaleType.value,
          questionNumber: elements.questionNumber.value,
          timestamp: new Date().toISOString()
        };
        
        localStorage.setItem(CONFIG.storageKey, JSON.stringify(data));
        showMessage('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } catch (error) {
        showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
        console.error('Save error:', error);
      }
    }
    
    /**
     * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
     */
    function loadSavedData() {
      try {
        const savedData = localStorage.getItem(CONFIG.storageKey);
        if (!savedData) {
          showMessage('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.', 'warning');
          return;
        }
        
        const data = JSON.parse(savedData);
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) {
          questionsData = data.questionsData || [];
          fixedWeights = data.fixedWeights;
          
          elements.sampleSize.value = data.sampleSize || '';
          elements.scaleType.value = data.scaleType || '';
          elements.questionNumber.value = data.questionNumber || '';
          
          if (fixedWeights) {
            elements.sampleSize.disabled = true;
            elements.scaleType.disabled = true;
          }
          
          // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
          if (data.scaleType) {
            elements.scaleType.dispatchEvent(new Event('change'));
          }
          
          renderTable();
          updateSummary();
          updateQuestionsCount();
          
          showMessage('âœ“ ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
      } catch (error) {
        showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
        console.error('Load error:', error);
      }
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
    // ============================================
    
    /**
     * Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
     */
    function calculateStatistics(counts, weights) {
      const total = counts.reduce((sum, count) => sum + count, 0);
      
      if (total === 0) {
        return { mean: 0, std: 0, variance: 0, cv: 0, median: 0 };
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­
      const weightedSum = counts.reduce((sum, count, i) => sum + count * weights[i], 0);
      const mean = weightedSum / total;
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¨Ø§ÙŠÙ† ÙˆØ§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ
      let variance = 0;
      for (let i = 0; i < counts.length; i++) {
        variance += counts[i] * Math.pow(weights[i] - mean, 2);
      }
      variance = variance / total;
      const std = Math.sqrt(variance);
      
      // Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù
      const cv = mean !== 0 ? (std / mean) * 100 : 0;
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ³ÙŠØ·
      const valuesArray = [];
      for (let i = 0; i < counts.length; i++) {
        for (let j = 0; j < counts[i]; j++) {
          valuesArray.push(weights[i]);
        }
      }
      valuesArray.sort((a, b) => a - b);
      
      const median = valuesArray.length % 2 === 0
        ? (valuesArray[valuesArray.length / 2 - 1] + valuesArray[valuesArray.length / 2]) / 2
        : valuesArray[Math.floor(valuesArray.length / 2)];
      
      return { mean, std, variance, cv, median };
    }
    
    /**
     * Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
     */
    function calculateOverallStatistics() {
      if (questionsData.length === 0 || !fixedWeights) {
        return null;
      }
      
      const combinedCounts = new Array(fixedWeights.length).fill(0);
      
      questionsData.forEach(q => {
        q.counts.forEach((count, i) => {
          combinedCounts[i] += count;
        });
      });
      
      return calculateStatistics(combinedCounts, fixedWeights);
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    // ============================================
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
     */
    function updateTableHeaders() {
      const scaleVal = elements.scaleType.value;
      const scale = CONFIG.scaleOptions[scaleVal];
      
      elements.resultsTableHead.innerHTML = '';
      
      if (!scale) return;
      
      const headerRow = document.createElement('tr');
      
      // Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      ['Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„', 'Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });
      
      // Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙØ¦Ø§Øª
      scale.forEach(label => {
        const th = document.createElement('th');
        th.textContent = label;
        th.title = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª: ${label}`;
        headerRow.appendChild(th);
      });
      
      // Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
      [
        { text: 'Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­', title: 'Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­' },
        { text: 'Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù', title: 'Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ' },
        { text: 'Ø§Ù„ØªØ¨Ø§ÙŠÙ†', title: 'ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' },
        { text: 'Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù %', title: 'Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (CV)' },
        { text: 'Ø§Ù„ÙˆØ³ÙŠØ·', title: 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ³Ø·Ù‰' }
      ].forEach(({ text, title }) => {
        const th = document.createElement('th');
        th.textContent = text;
        th.title = title;
        headerRow.appendChild(th);
      });
      
      // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª - Ù…Ø¹ class Ø®Ø§Øµ Ù„Ù„Ø¥Ø®ÙØ§Ø¡ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      const thActions = document.createElement('th');
      thActions.textContent = 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª';
      thActions.title = 'ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù';
      thActions.className = 'action-column';
      headerRow.appendChild(thActions);
      
      elements.resultsTableHead.appendChild(headerRow);
    }
    
    /**
     * Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£ÙˆØ²Ø§Ù†
     */
    function createWeightInputs(scale, scaleVal) {
      elements.weightInputsContainer.innerHTML = `
        <h4 style="color: #154360; margin-top: 0;">âš–ï¸ Ø£ÙˆØ²Ø§Ù† Ø§Ù„ÙØ¦Ø§Øª:</h4>
      `;
      
      // Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
      const noteDiv = document.createElement('div');
      noteDiv.className = 'note-box';
      noteDiv.innerHTML = `
        <strong>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:</strong>
        ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø­Ø³Ø¨ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ (Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø£Ùˆ Ø³Ù„Ø¨ÙŠ). 
        Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØªØ¨Ø¯Ø£ Ù…Ù† ${scale.length} ÙˆØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹.
        <br>Ù…Ø«Ø§Ù„: Ù„Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø³Ù„Ø¨ÙŠØ©ØŒ ÙŠÙ…ÙƒÙ† Ø¹ÙƒØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆØ²Ø§Ù†.
      `;
      elements.weightInputsContainer.appendChild(noteDiv);
      
      // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      const weightsGrid = document.createElement('div');
      weightsGrid.className = 'grid-2';
      
      scale.forEach((label, idx) => {
        const formGroup = document.createElement('div');
        formGroup.className = 'form-group';
        
        const lbl = document.createElement('label');
        lbl.textContent = `${label}:`;
        
        const input = document.createElement('input');
        input.type = 'number';
        input.step = 'any';
        input.placeholder = `Ø§Ù„ÙˆØ²Ù† Ù„Ù€: ${label}`;
        input.dataset.index = idx;
        input.value = CONFIG.defaultWeights[scaleVal][idx];
        input.required = true;
        
        formGroup.appendChild(lbl);
        formGroup.appendChild(input);
        weightsGrid.appendChild(formGroup);
      });
      
      elements.weightInputsContainer.appendChild(weightsGrid);
      elements.weightInputsContainer.classList.remove('hidden');
    }
    
    /**
     * Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
     */
    function createCountInputs(scale) {
      elements.inputsContainer.innerHTML = `
        <h4 style="color: #154360; margin-top: 0;">ğŸ“Š ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:</h4>
      `;
      
      const countsGrid = document.createElement('div');
      countsGrid.className = 'grid-2';
      
      scale.forEach(label => {
        const formGroup = document.createElement('div');
        formGroup.className = 'form-group';
        
        const lbl = document.createElement('label');
        lbl.textContent = `${label}:`;
        
        const input = document.createElement('input');
        input.type = 'number';
        input.min = '0';
        input.placeholder = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª: ${label}`;
        input.required = true;
        input.addEventListener('input', validateCountsSum);
        
        formGroup.appendChild(lbl);
        formGroup.appendChild(input);
        countsGrid.appendChild(formGroup);
      });
      
      elements.inputsContainer.appendChild(countsGrid);
      
      // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      const progressDiv = document.createElement('div');
      progressDiv.innerHTML = `
        <div style="margin-top: 15px; font-size: 14px; color: #5d6d7e;">
          <span id="countsSum">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</span>
          <span style="margin-right: 10px;" id="countsTarget">/ 0</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
        </div>
      `;
      elements.inputsContainer.appendChild(progressDiv);
      
      elements.inputsContainer.classList.remove('hidden');
    }
    
    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
     */
    function validateCountsSum() {
      const sampleSize = parseInt(elements.sampleSize.value) || 0;
      const countInputs = elements.inputsContainer.querySelectorAll('input[type="number"]');
      const counts = Array.from(countInputs).map(input => parseInt(input.value) || 0);
      const sum = counts.reduce((a, b) => a + b, 0);
      
      const sumElement = document.getElementById('countsSum');
      const targetElement = document.getElementById('countsTarget');
      const progressFill = document.getElementById('progressFill');
      
      if (sumElement) sumElement.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${sum}`;
      if (targetElement) targetElement.textContent = `/ ${sampleSize}`;
      
      if (progressFill && sampleSize > 0) {
        const percentage = Math.min((sum / sampleSize) * 100, 100);
        progressFill.style.width = `${percentage}%`;
        
        if (sum === sampleSize) {
          progressFill.style.background = 'linear-gradient(90deg, #16a085, #1abc9c)';
        } else if (sum > sampleSize) {
          progressFill.style.background = 'linear-gradient(90deg, #c0392b, #e74c3c)';
        } else {
          progressFill.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
        }
      }
    }
    
    /**
     * Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
     */
    function renderTable() {
      elements.resultsBody.innerHTML = '';
      
      questionsData.forEach((data, index) => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td><strong>Ø³${data.questionNum}</strong></td>
          <td>${data.sampleSize}</td>
          <td>${data.scaleVal} Ù†Ù‚Ø§Ø·</td>
          ${data.counts.map(c => `<td>${c}</td>`).join('')}
          <td><strong>${data.stats.mean.toFixed(3)}</strong></td>
          <td>${data.stats.std.toFixed(3)}</td>
          <td>${data.stats.variance.toFixed(3)}</td>
          <td>${data.stats.cv.toFixed(2)}%</td>
          <td>${data.stats.median.toFixed(3)}</td>
          <td class="action-column">
            <div class="action-buttons">
              <button class="btn-edit" onclick="editQuestion(${index})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„">
                âœï¸ ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button class="btn-delete" onclick="deleteQuestion(${index})" title="Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„">
                ğŸ—‘ï¸ Ø­Ø°Ù
              </button>
            </div>
          </td>
        `;
        
        elements.resultsBody.appendChild(row);
      });
      
      // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…
      if (questionsData.length > 0) {
        const overallStats = calculateOverallStatistics();
        if (overallStats) {
          const summaryRow = document.createElement('tr');
          summaryRow.className = 'summary-row';
          
          const combinedCounts = new Array(fixedWeights.length).fill(0);
          questionsData.forEach(q => {
            q.counts.forEach((count, i) => {
              combinedCounts[i] += count;
            });
          });
          
          summaryRow.innerHTML = `
            <td colspan="3"><strong>ğŸ“Š Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</strong></td>
            ${combinedCounts.map(c => `<td>${c}</td>`).join('')}
            <td><strong>${overallStats.mean.toFixed(3)}</strong></td>
            <td><strong>${overallStats.std.toFixed(3)}</strong></td>
            <td><strong>${overallStats.variance.toFixed(3)}</strong></td>
            <td><strong>${overallStats.cv.toFixed(2)}%</strong></td>
            <td><strong>${overallStats.median.toFixed(3)}</strong></td>
            <td class="action-column">-</td>
          `;
          
          elements.resultsBody.appendChild(summaryRow);
        }
      }
      
      updateQuestionsCount();
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…
     */
    function updateSummary() {
      if (questionsData.length === 0) {
        elements.summarySection.classList.add('hidden');
        return;
      }
      
      elements.summarySection.classList.remove('hidden');
      
      const overallStats = calculateOverallStatistics();
      if (!overallStats) return;
      
      const means = questionsData.map(q => q.stats.mean);
      const maxMean = Math.max(...means);
      const minMean = Math.min(...means);
      
      // Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ
      elements.summaryGrid.innerHTML = `
        <div class="summary-card">
          <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h4>
          <div class="value">${questionsData.length}</div>
        </div>
        <div class="summary-card">
          <h4>Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­ Ø§Ù„Ø¹Ø§Ù…</h4>
          <div class="value">${overallStats.mean.toFixed(2)}</div>
        </div>
        <div class="summary-card">
          <h4>Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ Ø§Ù„Ø¹Ø§Ù…</h4>
          <div class="value">${overallStats.std.toFixed(2)}</div>
        </div>
        <div class="summary-card">
          <h4>Ø§Ù„ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ù…</h4>
          <div class="value">${overallStats.variance.toFixed(2)}</div>
        </div>
        <div class="summary-card">
          <h4>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ø¹Ø§Ù…</h4>
          <div class="value">${overallStats.cv.toFixed(2)}%</div>
        </div>
        <div class="summary-card">
          <h4>Ø§Ù„ÙˆØ³ÙŠØ· Ø§Ù„Ø¹Ø§Ù…</h4>
          <div class="value">${overallStats.median.toFixed(2)}</div>
        </div>
        <div class="summary-card">
          <h4>Ø£Ø¹Ù„Ù‰ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</h4>
          <div class="value">${maxMean.toFixed(2)}</div>
        </div>
        <div class="summary-card">
          <h4>Ø£Ù‚Ù„ ÙˆØ³Ø· Ù…Ø±Ø¬Ø­</h4>
          <div class="value">${minMean.toFixed(2)}</div>
        </div>
      `;
      
      // Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ
      generateAnalyticalText(overallStats, maxMean, minMean);
    }
    
    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ
     */
    function generateAnalyticalText(stats, maxMean, minMean) {
      const { mean, std, variance, cv, median } = stats;
      const totalQuestions = questionsData.length;
      const scaleVal = parseInt(elements.scaleType.value);
      
      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
      let agreementLevel, agreementDesc;
      const maxWeight = Math.max(...fixedWeights);
      const normalizedMean = (mean / maxWeight) * 100;
      
      if (normalizedMean >= 80) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹';
        agreementDesc = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ ÙˆÙ‚Ø¨ÙˆÙ„ ÙˆØ§Ø³Ø¹ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else if (normalizedMean >= 70) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø§Ù„ÙŠØ©';
        agreementDesc = 'ØªØ¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡Ø§Ù‹ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Ù‹ Ù…Ù„Ø­ÙˆØ¸Ø§Ù‹ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else if (normalizedMean >= 60) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ù…ØªÙˆØ³Ø·Ø©';
        agreementDesc = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ù…Ø­Ø§ÙŠØ¯ ÙŠÙ…ÙŠÙ„ Ù†Ø­Ùˆ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©';
      } else if (normalizedMean >= 50) {
        agreementLevel = 'Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù†Ø®ÙØ¶Ø©';
        agreementDesc = 'ØªØ¹ÙƒØ³ ØªØ­ÙØ¸Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      } else {
        agreementLevel = 'Ø¹Ø¯Ù… Ù…ÙˆØ§ÙÙ‚Ø©';
        agreementDesc = 'ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø³Ù„Ø¨ÙŠ ÙˆØ§Ø¶Ø­ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      }
      
      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¬Ø§Ù†Ø³
      let homogeneityLevel, homogeneityDesc;
      if (std < 0.5) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ø¹Ø§Ù„Ù Ø¬Ø¯Ø§Ù‹';
        homogeneityDesc = 'Ù…Ù…Ø§ ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ø¹ Ù‚ÙˆÙŠ ÙˆØªØ·Ø§Ø¨Ù‚ ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡';
      } else if (std < 1.0) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ø¬ÙŠØ¯';
        homogeneityDesc = 'ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ³Ø§Ù‚ Ù…Ù„Ø­ÙˆØ¸ ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø¹ ØªØ¨Ø§ÙŠÙ† Ù…Ø­Ø¯ÙˆØ¯';
      } else if (std < 1.5) {
        homogeneityLevel = 'ØªØ¬Ø§Ù†Ø³ Ù…ØªÙˆØ³Ø·';
        homogeneityDesc = 'ÙŠØ¹ÙƒØ³ ÙˆØ¬ÙˆØ¯ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ¨Ø§ÙŠÙ† ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡ Ø¯ÙˆÙ† ØªØ´ØªØª ÙƒØ¨ÙŠØ±';
      } else {
        homogeneityLevel = 'ØªØ¨Ø§ÙŠÙ† Ù…Ù„Ø­ÙˆØ¸';
        homogeneityDesc = 'ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ø®ØªÙ„Ø§Ù ÙˆØ§Ø¶Ø­ ÙÙŠ ÙˆØ¬Ù‡Ø§Øª Ù†Ø¸Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†';
      }
      
      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§ØªØ³Ø§Ù‚
      let consistencyLevel, consistencyDesc;
      if (cv < 15) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ù…Ù…ØªØ§Ø²';
        consistencyDesc = 'ÙˆÙ‡Ùˆ Ø¶Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©';
      } else if (cv < 25) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ø¬ÙŠØ¯';
        consistencyDesc = 'ÙˆÙ‡Ùˆ Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ù„Ø¨Ø­ÙˆØ« Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©';
      } else if (cv < 35) {
        consistencyLevel = 'Ø§ØªØ³Ø§Ù‚ Ù…Ù‚Ø¨ÙˆÙ„';
        consistencyDesc = 'Ù…Ø¹ ÙˆØ¬ÙˆØ¯ ØªÙ†ÙˆØ¹ Ù…Ø¹ØªØ¯Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª';
      } else {
        consistencyLevel = 'ØªÙ†ÙˆØ¹ ÙƒØ¨ÙŠØ±';
        consistencyDesc = 'Ù…Ù…Ø§ ÙŠØ³ØªØ¯Ø¹ÙŠ ÙØ­ØµØ§Ù‹ Ø£Ø¹Ù…Ù‚ Ù„Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø©';
      }
      
      const range = maxMean - minMean;
      const rangeDesc = range < 1 ? 'ØªÙ‚Ø§Ø±Ø¨ ÙƒØ¨ÙŠØ±' : range < 2 ? 'ØªØ¨Ø§ÙŠÙ† Ù…Ø¹ØªØ¯Ù„' : 'ØªØ¨Ø§ÙŠÙ† Ù…Ù„Ø­ÙˆØ¸';
      
      elements.analyticalText.innerHTML = `
        <div style="background-color: #f8f9fa; border-right: 5px solid var(--primary-color); border-radius: 10px; padding: 25px; line-height: 2; text-align: justify;">
          <h3 style="color: var(--primary-dark); margin-bottom: 20px; text-align: center;">
            ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙˆØ¹ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬
          </h3>
          
          <div class="note-box" style="background: #e8f8f5; border-color: var(--success-color);">
            <strong>ğŸ“Œ ØªÙ†ÙˆÙŠÙ‡ Ù…Ù†Ù‡Ø¬ÙŠ:</strong>
            ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ø­ÙŠØ« ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª 
            ÙˆØ§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø© ÙƒÙƒÙ„ØŒ ÙˆÙ„ÙŠØ³ Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ù…ØªÙˆØ³Ø· Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ 
            ÙˆØ°Ù„Ùƒ Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ø§Ù… Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©.
          </div>
          
          <p style="margin: 20px 0; font-size: 15px;">
            <strong style="color: var(--primary-dark);">Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ù†Ø¸Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</strong><br/>
            Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ù€ <strong style="color: var(--primary-color);">(${totalQuestions})</strong> 
            Ø³Ø¤Ø§Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†ØŒ Ø£Ø¸Ù‡Ø±Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­ Ø¨Ù„Øº 
            <strong style="color: var(--primary-color);">(${mean.toFixed(2)})</strong> 
            Ù…Ù† Ø£ØµÙ„ <strong>(${maxWeight})</strong>ØŒ Ù…Ù…Ø§ ÙŠØ¹ÙƒØ³ Ù…Ø³ØªÙˆÙ‰ 
            <strong style="color: var(--success-color);">${agreementLevel}</strong> Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†ØŒ ${agreementDesc}.
          </p>
          
          <p style="margin: 20px 0; font-size: 15px;">
            <strong style="color: var(--primary-dark);">Ø«Ø§Ù†ÙŠØ§Ù‹: ØªØ¬Ø§Ù†Ø³ Ø§Ù„Ø¢Ø±Ø§Ø¡</strong><br/>
            Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ <strong style="color: var(--primary-color);">(${std.toFixed(2)})</strong> 
            ÙˆÙ‡Ùˆ Ù…Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ <strong style="color: var(--success-color);">${homogeneityLevel}</strong> ${homogeneityDesc}. 
            ÙƒÙ…Ø§ Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ¨Ø§ÙŠÙ† <strong>(${variance.toFixed(2)})</strong> Ù…Ù…Ø§ ÙŠØ¤ÙƒØ¯ Ù‡Ø°Ø§ Ø§Ù„ØªÙˆØ¬Ù‡ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
          </p>
          
          <p style="margin: 20px 0; font-size: 15px;">
            <strong style="color: var(--primary-dark);">Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§ØªØ³Ø§Ù‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª</strong><br/>
            Ø³Ø¬Ù„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ù…ØªÙˆØ³Ø·Ø§Ù‹ Ù‚Ø¯Ø±Ù‡ <strong style="color: var(--primary-color);">(${cv.toFixed(2)}%)</strong> 
            ÙˆÙ‡Ùˆ ÙŠÙ…Ø«Ù„ <strong style="color: var(--success-color);">${consistencyLevel}</strong> ${consistencyDesc}. 
            Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¤Ø´Ø± ÙŠØ¹ØªØ¨Ø± Ù…Ù‚ÙŠØ§Ø³Ø§Ù‹ Ù†Ø³Ø¨ÙŠØ§Ù‹ Ù…Ù‡Ù…Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©.
          </p>
          
          <p style="margin: 20px 0; font-size: 15px;">
            <strong style="color: var(--primary-dark);">Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ØªØ¨Ø§ÙŠÙ†</strong><br/>
            ØªØ±Ø§ÙˆØ­Øª Ù‚ÙŠÙ… Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­ Ø¨ÙŠÙ† <strong style="color: var(--primary-color);">(${minMean.toFixed(2)})</strong> 
            ÙƒØ£Ø¯Ù†Ù‰ Ù‚ÙŠÙ…Ø© Ùˆ<strong style="color: var(--primary-color);">(${maxMean.toFixed(2)})</strong> ÙƒØ£Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø©ØŒ 
            Ù…Ù…Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ <strong>${rangeDesc}</strong> ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø¹Ø¨Ø± Ù…Ø®ØªÙ„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. 
            ÙƒÙ…Ø§ Ø¨Ù„Øº Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ³ÙŠØ· <strong>(${median.toFixed(2)})</strong> ÙˆÙ‡Ùˆ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØŒ 
            Ù…Ù…Ø§ ÙŠØ¹Ø²Ø² Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„.
          </p>
          
          <p style="margin: 20px 0 0 0; font-size: 15px; padding: 15px; background: #e8f8f5; border-radius: 8px;">
            <strong style="color: var(--primary-dark);">Ø§Ù„Ø®Ù„Ø§ØµØ©:</strong><br/>
            ${normalizedMean >= 70 && cv < 25 
              ? 'ØªØ´ÙŠØ± Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ø¥Ù„Ù‰ <strong style="color: var(--success-color);">Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…ØªØ³Ù‚Ø©</strong> ØªØ¹ÙƒØ³ ÙˆØ¶ÙˆØ­Ø§Ù‹ ÙÙŠ ØªÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙˆØ§ØªØ³Ø§Ù‚Ø§Ù‹ ÙÙŠ Ø¢Ø±Ø§Ø¦Ù‡Ù….'
              : normalizedMean >= 60
              ? 'ØªØ´ÙŠØ± Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ø¥Ù„Ù‰ <strong style="color: var(--warning-color);">Ù†ØªØ§Ø¦Ø¬ Ù…Ù‚Ø¨ÙˆÙ„Ø©</strong> Ù…Ø¹ ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ø§Ù„ Ù„Ù„ØªØ­Ø³ÙŠÙ† ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø­Ø§ÙˆØ±.'
              : 'ØªØ´ÙŠØ± Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ø¥Ù„Ù‰ <strong style="color: var(--error-color);">Ù†ØªØ§Ø¦Ø¬ ØªØ³ØªØ¯Ø¹ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø±</strong> ÙÙŠ Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.'}
            ${cv > 30 ? '<br><br>ğŸ’¡ <em>ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø£Ø¹Ù…Ù‚ Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø°Ø§Øª Ø§Ù„ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ù„ÙŠ Ù„ÙÙ‡Ù… Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡.</em>' : ''}
          </p>
        </div>
      `;
    }

    // ============================================
    // Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Handlers)
    // ============================================
    
    /**
     * ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³
     */
    elements.scaleType.addEventListener('change', () => {
      const scaleVal = elements.scaleType.value;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
      if (questionsData.length > 0) {
        showMessage('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.', 'error');
        elements.scaleType.value = questionsData[0].scaleVal;
        return;
      }
      
      if (fixedWeights !== null) {
        showMessage('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø¹Ø¯ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ÙˆØ²Ø§Ù†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.', 'error');
        elements.scaleType.value = elements.scaleType.dataset.currentValue || '';
        return;
      }
      
      hideAllMessages();
      
      if (!scaleVal) {
        elements.weightInputsContainer.classList.add('hidden');
        elements.inputsContainer.classList.add('hidden');
        return;
      }
      
      elements.scaleType.dataset.currentValue = scaleVal;
      
      const scale = CONFIG.scaleOptions[scaleVal];
      updateTableHeaders();
      createWeightInputs(scale, scaleVal);
      createCountInputs(scale);
      
      showMessage('âœ“ ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©.', 'success');
    });
    
    /**
     * Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø³Ø¤Ø§Ù„
     */
    elements.calculateBtn.addEventListener('click', () => {
      hideAllMessages();
      
      const questionNum = elements.questionNumber.value.trim();
      const sampleSize = parseInt(elements.sampleSize.value);
      const scaleVal = elements.scaleType.value;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      if (!validateInputs(questionNum, sampleSize, scaleVal)) {
        return;
      }
      
      const countInputs = elements.inputsContainer.querySelectorAll('input[type="number"]');
      const weightInputs = elements.weightInputsContainer.querySelectorAll('input[type="number"]');
      
      // ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
      if (!fixedWeights) {
        fixedWeights = Array.from(weightInputs).map(input => parseFloat(input.value || '0'));
        
        if (fixedWeights.some(isNaN) || fixedWeights.some(w => w === 0)) {
          showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ÙƒÙ„ ÙØ¦Ø© (Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† ØµÙØ±Ø§Ù‹).", 'error');
          fixedWeights = null;
          return;
        }
        
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
        Array.from(weightInputs).forEach(input => input.disabled = true);
        elements.sampleSize.disabled = true;
        elements.scaleType.disabled = true;
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
        elements.saveDataBtn.classList.remove('hidden');
        elements.loadDataBtn.classList.remove('hidden');
        
        showMessage('âœ“ ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙˆØ­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.', 'success');
      }
      
      // Ø¬Ù…Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
      const counts = Array.from(countInputs).map(input => parseInt(input.value || '0'));
      
      if (counts.every(c => c === 0)) {
        showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ù„ÙƒÙ„ ÙØ¦Ø©.", 'error');
        return;
      }
      
      const total = counts.reduce((a, b) => a + b, 0);
      
      if (total !== sampleSize) {
        showMessage(
          `âŒ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª (${total}) Ù„Ø§ ÙŠØ³Ø§ÙˆÙŠ Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© (${sampleSize}). Ø§Ù„ÙØ±Ù‚: ${Math.abs(total - sampleSize)}`,
          'error'
        );
        return;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
      const stats = calculateStatistics(counts, fixedWeights);
      
      const questionData = {
        questionNum,
        sampleSize,
        scaleVal,
        counts: [...counts],
        stats
      };
      
      // ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ©
      if (editingIndex >= 0) {
        questionsData[editingIndex] = questionData;
        editingIndex = -1;
        elements.btnText.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„';
        showMessage('âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } else {
        questionsData.push(questionData);
        // Ø²ÙŠØ§Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        const nextNum = parseInt(questionNum) + 1;
        if (!isNaN(nextNum)) {
          elements.questionNumber.value = nextNum;
        }
        showMessage('âœ“ ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      }
      
      renderTable();
      updateSummary();
      resetInputFields();
      
      // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      saveDataLocally();
    });
    
    /**
     * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
     */
    function resetInputFields() {
      const countInputs = elements.inputsContainer.querySelectorAll('input[type="number"]');
      countInputs.forEach(input => input.value = '');
      validateCountsSum();
    }
    
    /**
     * ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¤Ø§Ù„
     */
    window.editQuestion = function(index) {
      const data = questionsData[index];
      
      elements.questionNumber.value = data.questionNum;
      
      const countInputs = elements.inputsContainer.querySelectorAll('input[type="number"]');
      data.counts.forEach((count, i) => {
        if (countInputs[i]) {
          countInputs[i].value = count;
        }
      });
      
      editingIndex = index;
      elements.btnText.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„';
      
      showMessage('ğŸ’¡ Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„"', 'success');
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
      validateCountsSum();
    };
    
    /**
     * Ø­Ø°Ù Ø³Ø¤Ø§Ù„
     */
    window.deleteQuestion = function(index) {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù… ${questionsData[index].questionNum}ØŸ`)) {
        questionsData.splice(index, 1);
        renderTable();
        updateSummary();
        showMessage('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        
        if (questionsData.length === 0) {
          resetAll();
        } else {
          saveDataLocally();
        }
      }
    };
    
    /**
     * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
     */
    function resetAll() {
      fixedWeights = null;
      questionsData = [];
      editingIndex = -1;
      
      elements.sampleSize.disabled = false;
      elements.scaleType.disabled = false;
      elements.sampleSize.value = '';
      elements.scaleType.value = '';
      elements.questionNumber.value = '';
      
      elements.weightInputsContainer.innerHTML = '';
      elements.inputsContainer.innerHTML = '';
      elements.resultsBody.innerHTML = '';
      elements.resultsTableHead.innerHTML = '';
      elements.summaryGrid.innerHTML = '';
      elements.analyticalText.innerHTML = '';
      
      elements.weightInputsContainer.classList.add('hidden');
      elements.inputsContainer.classList.add('hidden');
      elements.summarySection.classList.add('hidden');
      elements.saveDataBtn.classList.add('hidden');
      elements.loadDataBtn.classList.add('hidden');
      
      elements.btnText.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„';
      elements.scaleType.dataset.currentValue = '';
      
      hideAllMessages();
      updateQuestionsCount();
      
      // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      localStorage.removeItem(CONFIG.storageKey);
    }
    
    /**
     * Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
     */
    elements.resetBtn.addEventListener('click', () => {
      if (questionsData.length > 0) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) {
          return;
        }
      }
      
      resetAll();
      showMessage('âœ“ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©.', 'success');
    });
    
    /**
     * Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    elements.saveDataBtn.addEventListener('click', saveDataLocally);
    
    /**
     * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    elements.loadDataBtn.addEventListener('click', loadSavedData);

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±
    // ============================================
    
    /**
     * Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word
     */
    window.exportToWord = function() {
  if (questionsData.length === 0) {
    showMessage("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.", 'warning');
    return;
  }

  hideAllMessages();

  // Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ§Ù…Ù„Ø§Ù‹
  const tableClone = elements.resultsTable.cloneNode(true);

  // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø£Ø³
  const headerRow = tableClone.querySelector('thead tr');
  if (headerRow) {
    const actionHeader = headerRow.querySelector('.action-column');
    if (actionHeader) {
      actionHeader.remove();
    }
  }

  // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
  const dataRows = tableClone.querySelectorAll('tbody tr');
  dataRows.forEach(row => {
    const actionCell = row.querySelector('.action-column');
    if (actionCell) {
      actionCell.remove();
    }
  });

  const htmlContent = `
  <html>
  <head>
    <meta charset="UTF-8">
    <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©</title>
    <style>
  body { 
    font-family: 'Arial', Simplified Arabic; 
    direction: rtl; 
    text-align: center;   /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£ÙŠØ¶Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
  }
  table { 
    border-collapse: collapse; 
    width: 90%; 
    margin: 0 auto; 
  }
  th, td { 
    border: 1px solid #000; 
    padding: 8px; 
    text-align: center; 
  }
  th { 
    background-color: #2874a6; 
    color: white; 
  }
  .summary-row td {
    background-color: #fef9e7;
    font-weight: bold;
  }
  h2 {
    text-align: center;
  }
</style>
  </head>
  <body>
    <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©</h2>
    ${tableClone.outerHTML}
    <br/>
    ${elements.analyticalText.innerHTML}
  </body>
  </html>
  `;

  const blob = new Blob(['\ufeff', htmlContent], {
    type: 'application/msword'
  });

  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©_Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©.doc";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  showMessage("âœ“ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­.", 'success');
};

  </script>
</body>
</html>
