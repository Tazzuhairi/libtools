<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­ ÙˆØ§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    body {
      font-family: 'Cairo', Tahoma, sans-serif;
      background-color: #e9f0f7;
      padding: 25px;
      max-width: 960px;
      margin: auto;
      color: #2c3e50;
    }
    h2, h3 {
      text-align: center;
      color: #1a5276;
      font-weight: 700;
      margin-bottom: 10px;
    }
    label {
      display: flex;
      align-items: center;
      font-weight: 600;
      margin-top: 18px;
      color: #154360;
      font-size: 17px;
      gap: 8px;
    }
    input, select {
      padding: 10px 12px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
      border: 2px solid #2980b9;
      border-radius: 6px;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #1f618d;
      background-color: #d6eaf8;
    }
    button {
      padding: 12px 25px;
      background: linear-gradient(45deg, #2e86c1, #2874a6);
      color: white;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(41, 128, 185, 0.3);
      transition: background 0.3s ease;
      min-width: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button:hover {
      background: linear-gradient(45deg, #1b4f72, #154360);
    }
    .buttons-row {
      display: flex;
      justify-content: flex-start;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .section {
      background: #fefefe;
      border-radius: 12px;
      padding: 25px 30px;
      margin-top: 30px;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.07);
      border: 1.5px solid #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
      background-color: white;
      direction: rtl;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 12px rgba(41, 128, 185, 0.2);
      font-size: 15px;
      user-select: none;
    }
    th, td {
      border: 1px solid #aed6f1;
      padding: 10px 12px;
      text-align: center;
      vertical-align: middle;
      transition: background-color 0.25s ease;
    }
    th {
      background-color: #2874a6;
      color: #ecf0f1;
      font-weight: 700;
      letter-spacing: 0.1em;
      user-select: none;
    }
    tr:nth-child(even) td {
      background-color: #f9fbfe;
    }
    tr:hover td {
      background-color: #d6eaf8;
    }
    footer {
      margin-top: 45px;
      text-align: center;
      font-size: 14px;
      color: #5d6d7e;
      font-style: italic;
      user-select: none;
    }
    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø·ÙˆØ· Ø±Ù…ÙˆØ² Unicode */
    .icon-sample-size::before { content: "ğŸ“Š"; }
    .icon-scale-type::before { content: "âš–ï¸"; }
    .icon-question-number::before { content: "â“"; }
    .icon-weight::before { content: "âš™ï¸"; }
    .icon-count::before { content: "ğŸ”¢"; }
    button svg, button .btn-icon {
      font-size: 18px;
    }
    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */
    #errorMessage {
      color: #c0392b;
      background-color: #f9e6e6;
      border: 1px solid #e74c3c;
      padding: 12px 15px;
      margin-top: 15px;
      border-radius: 8px;
      font-weight: 600;
      display: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <h2>Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø­ØµØ§Ø¦ÙŠØ©</h2>

  <div class="section">
    <label for="sampleSize" class="icon-sample-size">Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©:</label>
    <input type="number" id="sampleSize" placeholder="Ù…Ø«Ø§Ù„: 30" min="1" />

    <label for="scaleType" class="icon-scale-type">Ù†ÙˆØ¹ Ù…Ù‚ÙŠØ§Ø³ Ù„ÙŠÙƒØ±Øª:</label>
    <select id="scaleType">
      <option value="" selected>-- Ø§Ø®ØªØ± --</option>
      <option value="2">Ø«Ù†Ø§Ø¦ÙŠ</option>
      <option value="3">Ø«Ù„Ø§Ø«ÙŠ</option>
      <option value="5">Ø®Ù…Ø§Ø³ÙŠ</option>
    </select>

    <label for="questionNumber" class="icon-question-number">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
    <input type="text" id="questionNumber" placeholder="Ù…Ø«Ø§Ù„: 1 Ø£Ùˆ 2 Ø£Ùˆ ..." />

    <div id="weightInputsContainer" class="section hidden"></div>
    <div id="inputsContainer" class="section hidden"></div>

    <button id="calculateQuestionBtn" title="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„">
      <span class="btn-icon">â•</span> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„
    </button>

    <div id="errorMessage"></div>
  </div>

  <div class="section">
    <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <table id="resultsTable" dir="rtl">
      <thead id="resultsTableHead"></thead>
      <tbody></tbody>
    </table>
    <div class="buttons-row">
      <button onclick="exportToWord()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Word">
        <span class="btn-icon">ğŸ“„</span> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word
      </button>
      <button id="resetBtn" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø©">
        <span class="btn-icon">ğŸ”„</span> Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
    </div>
  </div>

  <footer>
    Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 - Ø¯. Ø·Ù„Ø§Ù„ Ù†Ø§Ø¸Ù… Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ
  </footer>

  <script>
    const scaleOptions = {
      2: ["Ù…ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
      3: ["Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚"],
      5: ["Ù…ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©", "Ù…ÙˆØ§ÙÙ‚", "Ù…Ø­Ø§ÙŠØ¯", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚", "Ù„Ø§ Ø£ÙˆØ§ÙÙ‚ Ø¨Ø´Ø¯Ø©"]
    };

    let fixedWeights = null;
    const inputsContainer = document.getElementById('inputsContainer');
    const weightInputsContainer = document.getElementById('weightInputsContainer');
    const scaleType = document.getElementById('scaleType');
    const questionNumberInput = document.getElementById('questionNumber');
    const sampleSizeInput = document.getElementById('sampleSize');
    const resultsTable = document.getElementById('resultsTable');
    const resultsBody = resultsTable.querySelector('tbody');
    const resultsTableHead = document.getElementById('resultsTableHead');
    const errorMessage = document.getElementById('errorMessage');

    // ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ
    function updateTableHeaders() {
      const scale = scaleOptions[scaleType.value];
      resultsTableHead.innerHTML = '';

      if (!scale) return;

      const headerRow = document.createElement('tr');

      ['Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³', 'Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });

      scale.forEach(label => {
        const th = document.createElement('th');
        th.textContent = label;
        headerRow.appendChild(th);
      });

      ['Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø±Ø¬Ø­', 'Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });

      resultsTableHead.appendChild(headerRow);
    }

    scaleType.addEventListener('change', () => {
      fixedWeights = null;
      weightInputsContainer.innerHTML = '';
      inputsContainer.innerHTML = '';
      questionNumberInput.value = '';
      errorMessage.style.display = 'none'; // Ø§Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‚ÙŠØ§Ø³
      updateTableHeaders();

      const scale = scaleOptions[scaleType.value];
      if (!scale) return;

      // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ù…Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
      weightInputsContainer.innerHTML = '';
      scale.forEach((label, idx) => {
        const div = document.createElement('div');
        div.style.marginTop = '12px';
        const input = document.createElement('input');
        input.type = 'number';
        input.step = 'any';
        input.placeholder = `Ø§Ù„ÙˆØ²Ù† Ù„Ù€: ${label}`;
        input.dataset.index = idx;
        input.style.width = '100%';
        div.appendChild(input);
        weightInputsContainer.appendChild(div);
      });
      weightInputsContainer.classList.remove('hidden');

      // Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ù…Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
      inputsContainer.innerHTML = '';
      scale.forEach(label => {
        const input = document.createElement('input');
        input.type = 'number';
        input.min = 0;
        input.placeholder = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª: ${label}`;
        inputsContainer.appendChild(input);
      });
      inputsContainer.classList.remove('hidden');
    });

    document.getElementById('calculateQuestionBtn').addEventListener('click', () => {
      errorMessage.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù‚Ø¨Ù„ Ø§Ù„ÙØ­Øµ
      const questionNum = questionNumberInput.value.trim();
      const sampleSize = parseInt(sampleSizeInput.value.trim());
      const scaleVal = scaleType.value;

      if (!questionNum) {
        showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„.");
        return;
      }
      if (!sampleSize || sampleSize <= 0) {
        showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø¬Ù… Ø¹ÙŠÙ†Ø© ØµØ­ÙŠØ­.");
        return;
      }
      if (!scaleVal) {
        showError("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³.");
        return;
      }

      const countInputs = inputsContainer.querySelectorAll('input');
      const weightInputs = weightInputsContainer.querySelectorAll('input');

      if (!fixedWeights) {
        fixedWeights = Array.from(weightInputs).map(input => parseFloat(input.value || '0'));
        if (fixedWeights.some(isNaN)) {
          showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ÙƒÙ„ ÙØ¦Ø©.");
          return;
        }
        Array.from(weightInputs).forEach(input => input.disabled = true);
        sampleSizeInput.disabled = true;
        scaleType.disabled = true;
      }

      const counts = Array.from(countInputs).map(input => parseInt(input.value || '0'));
      if (counts.reduce((a, b) => a + b, 0) === 0) {
        showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª.");
        return;
      }

      const total = counts.reduce((a, b) => a + b, 0);

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø§ÙˆÙŠ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¬ÙˆØ¨Ø© Ù…Ø¹ Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©
      if (total !== sampleSize) {
        showError(`Ø®Ø·Ø£: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¬ÙˆØ¨Ø© (${total}) Ù„Ø§ ÙŠØ³Ø§ÙˆÙŠ Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© (${sampleSize}). ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ….`);
        return; // ÙŠÙ…Ù†Ø¹ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
      }

      const weightedSum = counts.reduce((sum, c, i) => sum + c * fixedWeights[i], 0);
      const mean = weightedSum / total;

      let variance = 0;
      for (let i = 0; i < counts.length; i++) {
        variance += counts[i] * Math.pow(fixedWeights[i] - mean, 2);
      }
      variance = variance / total;
      const std = Math.sqrt(variance);

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${sampleSize}</td>
        <td>${scaleVal}</td>
        <td>${questionNum}</td>
        ${counts.map(c => `<td>${c}</td>`).join('')}
        <td>${mean.toFixed(2)}</td>
        <td>${std.toFixed(2)}</td>
      `;
      resultsBody.appendChild(row);

      questionNumberInput.value = parseInt(questionNum) + 1;

      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª ÙÙ‚Ø· (Ù„Ù„Ù…Ù‚ÙŠØ§Ø³ Ù†ÙØ³Ù‡)
      inputsContainer.innerHTML = '';
      const scale = scaleOptions[scaleType.value];
      scale.forEach(label => {
        const input = document.createElement('input');
        input.type = 'number';
        input.min = 0;
        input.placeholder = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª: ${label}`;
        inputsContainer.appendChild(input);
      });
      inputsContainer.classList.remove('hidden');
    });

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    }

    // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
    document.getElementById('resetBtn').addEventListener('click', () => {
      fixedWeights = null;
      sampleSizeInput.disabled = false;
      scaleType.disabled = false;
      weightInputsContainer.innerHTML = '';
      inputsContainer.innerHTML = '';
      questionNumberInput.value = '';
      sampleSizeInput.value = '';
      scaleType.value = '';
      resultsBody.innerHTML = '';
      resultsTableHead.innerHTML = '';
      errorMessage.style.display = 'none';
      weightInputsContainer.classList.add('hidden');
      inputsContainer.classList.add('hidden');
    });

    // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Ù…Ù„Ù Word
    function exportToWord() {
      if (!resultsBody.hasChildNodes()) {
        showError("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");
        return;
      }
      errorMessage.style.display = 'none';
      let html = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' 
          xmlns:w='urn:schemas-microsoft-com:office:word' 
          xmlns='http://www.w3.org/TR/REC-html40'>
          <head><title>ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Word</title></head><body>${resultsTable.outerHTML}</body></html>`;
      const blob = new Blob(['\ufeff', html], {type: 'application/msword'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.doc';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }
  </script>
</body>
</html>
