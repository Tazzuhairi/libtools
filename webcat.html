<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet"/>
<style>
  :root {
    --ink: #1a1207;
    --paper: #faf7f0;
    --parchment: #f0ead6;
    --gold: #b8860b;
    --gold-light: #d4a843;
    --gold-pale: #f5e6b3;
    --border: #8b6914;
    --muted: #6b5a3e;
    --accent: #2c4a1e;
    --accent-light: #4a7a32;
    --white: #ffffff;
    --shadow: rgba(26,18,7,0.15);
    --input-bg: #fffdf7;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Cairo', sans-serif;
    background-color: var(--paper);
    background-image:
      radial-gradient(ellipse at 20% 10%, rgba(184,134,11,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 90%, rgba(44,74,30,0.05) 0%, transparent 50%);
    min-height: 100vh;
    padding: 30px 20px 60px;
    color: var(--ink);
  }

  .page-header {
    text-align: center;
    margin-bottom: 36px;
  }

  .page-header .ornament {
    font-family: 'Amiri', serif;
    font-size: 28px;
    color: var(--gold);
    letter-spacing: 8px;
    display: block;
    margin-bottom: 6px;
    opacity: 0.7;
  }

  .page-header h1 {
    font-family: 'Amiri', serif;
    font-size: 2.1rem;
    font-weight: 700;
    color: var(--ink);
    line-height: 1.3;
    position: relative;
    display: inline-block;
  }

  .page-header h1::after {
    content: '';
    display: block;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    margin-top: 8px;
  }

  .page-header .subtitle {
    font-size: 0.88rem;
    color: var(--muted);
    margin-top: 8px;
    font-weight: 300;
    letter-spacing: 1px;
  }

  .main-card {
    background: var(--white);
    border: 1px solid rgba(184,134,11,0.3);
    border-radius: 4px;
    max-width: 800px;
    margin: 0 auto;
    box-shadow: 0 2px 30px var(--shadow), 0 0 0 4px rgba(184,134,11,0.06);
    overflow: hidden;
  }

  .card-band {
    background: linear-gradient(135deg, var(--accent) 0%, #1a3012 100%);
    padding: 18px 28px;
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .card-band .band-icon {
    font-size: 26px;
    opacity: 0.9;
  }

  .card-band .band-title {
    font-family: 'Amiri', serif;
    font-size: 1.25rem;
    color: var(--gold-light);
    font-weight: 700;
  }

  .card-band .lang-selector {
    margin-right: auto;
    margin-left: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .lang-selector select {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(212,168,67,0.5);
    color: var(--gold-pale);
    padding: 5px 12px;
    border-radius: 20px;
    font-family: 'Cairo', sans-serif;
    font-size: 0.82rem;
    cursor: pointer;
    outline: none;
    transition: background 0.2s;
  }

  .lang-selector select option { background: #1a3012; color: #fff; }
  .lang-selector select:hover { background: rgba(255,255,255,0.2); }

  .form-body {
    padding: 28px 30px 24px;
  }

  .section-title {
    font-family: 'Amiri', serif;
    font-size: 1rem;
    color: var(--muted);
    border-bottom: 1px solid var(--parchment);
    padding-bottom: 6px;
    margin: 24px 0 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-title:first-of-type { margin-top: 0; }

  .section-title .sec-icon { font-size: 16px; }

  .field-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  .field-row.single { grid-template-columns: 1fr; }
  .field-row.triple { grid-template-columns: 1fr 1fr 1fr; }

  .field-group { margin-bottom: 0; }

  label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  input[type="text"], textarea, select.field-select {
    width: 100%;
    padding: 10px 14px;
    font-size: 0.95rem;
    font-family: 'Cairo', sans-serif;
    border: 1.5px solid #e0d8c8;
    border-radius: 3px;
    background: var(--input-bg);
    color: var(--ink);
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }

  input[type="text"]:focus, textarea:focus, select.field-select:focus {
    border-color: var(--gold);
    box-shadow: 0 0 0 3px rgba(184,134,11,0.1);
  }

  textarea {
    resize: vertical;
    min-height: 70px;
    line-height: 1.6;
  }

  .add-author-btn {
    margin-top: 8px;
    background: none;
    border: 1.5px dashed var(--gold);
    color: var(--gold);
    padding: 7px 16px;
    border-radius: 3px;
    font-family: 'Cairo', sans-serif;
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .add-author-btn:hover {
    background: var(--gold-pale);
    border-style: solid;
  }

  .extra-author-row {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    align-items: center;
  }

  .extra-author-row input { flex: 1; margin-bottom: 0; }

  .remove-author {
    background: none;
    border: none;
    color: #c0392b;
    font-size: 18px;
    cursor: pointer;
    padding: 0 4px;
    line-height: 1;
    flex-shrink: 0;
    opacity: 0.6;
    transition: opacity 0.2s;
  }

  .remove-author:hover { opacity: 1; }

  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--parchment), transparent);
    margin: 22px 0;
  }

  /* Card type selector */
  .card-type-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 16px 0;
  }

  .card-type-btn {
    border: 1.5px solid #e0d8c8;
    background: var(--input-bg);
    padding: 10px 8px;
    border-radius: 3px;
    text-align: center;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--muted);
    transition: all 0.2s;
    position: relative;
  }

  .card-type-btn:hover { border-color: var(--gold); color: var(--gold); }

  .card-type-btn.active {
    border-color: var(--gold);
    background: var(--gold-pale);
    color: var(--border);
    box-shadow: 0 2px 8px rgba(184,134,11,0.15);
  }

  .card-type-btn .type-icon { display: block; font-size: 20px; margin-bottom: 4px; }

  .generate-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--accent) 0%, #1a3012 100%);
    color: var(--gold-pale);
    border: none;
    border-radius: 3px;
    font-family: 'Amiri', serif;
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 1px;
    margin-top: 20px;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }

  .generate-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; right: auto;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
    transition: left 0.5s;
  }

  .generate-btn:hover::before { left: 100%; }
  .generate-btn:hover { box-shadow: 0 4px 20px rgba(44,74,30,0.35); }
  .generate-btn:active { transform: scale(0.99); }

  /* Output section */
  .output-section {
    display: none;
    padding: 0 30px 30px;
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .output-label {
    font-family: 'Amiri', serif;
    font-size: 1rem;
    color: var(--muted);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--parchment);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* The actual catalog card */
  .catalog-card {
    border: 2px solid var(--ink);
    background: var(--paper);
    padding: 0;
    font-family: 'Amiri', serif;
    position: relative;
    margin-bottom: 20px;
    box-shadow: 4px 4px 0 rgba(26,18,7,0.12);
  }

  .catalog-card-inner {
    padding: 16px 20px 20px;
    min-height: 160px;
    direction: rtl;
  }

  .catalog-card .call-number {
    position: absolute;
    top: 8px;
    left: 12px;
    text-align: center;
    font-size: 0.9rem;
    font-weight: 700;
    line-height: 1.4;
    border: 1px solid var(--ink);
    padding: 3px 7px;
    min-width: 52px;
    background: var(--white);
    font-family: 'Cairo', sans-serif;
  }

  .catalog-card .main-entry {
    font-size: 1.05rem;
    font-weight: 700;
    margin-bottom: 4px;
    padding-right: 0;
    padding-left: 70px;
    line-height: 1.5;
  }

  .catalog-card .description-area {
    padding-right: 28px;
    padding-left: 70px;
    font-size: 0.95rem;
    line-height: 1.75;
  }

  .catalog-card .desc-line {
    display: block;
  }

  .catalog-card .tracing {
    border-top: 1px solid #ccc;
    margin-top: 14px;
    padding-top: 10px;
    font-size: 0.82rem;
    color: var(--muted);
    direction: rtl;
  }

  .catalog-card .tracing-item {
    display: inline-block;
    margin-left: 16px;
    margin-bottom: 3px;
  }

  .catalog-card .corner-mark {
    position: absolute;
    bottom: 8px;
    left: 12px;
    font-size: 0.75rem;
    font-family: 'Cairo', sans-serif;
    color: var(--muted);
    border-top: 1px solid #ccc;
    padding-top: 3px;
    min-width: 52px;
    text-align: center;
  }

  /* Export action buttons */
  .export-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 8px;
  }

  .export-btn {
    padding: 10px 8px;
    border: 1.5px solid;
    border-radius: 3px;
    font-family: 'Cairo', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    background: var(--white);
  }

  .export-btn .btn-icon { font-size: 18px; }

  .export-btn.btn-word { border-color: #2b5797; color: #2b5797; }
  .export-btn.btn-word:hover { background: #e8f0fa; }

  .export-btn.btn-marc { border-color: #8b1a1a; color: #8b1a1a; }
  .export-btn.btn-marc:hover { background: #faeaea; }

  .export-btn.btn-rda { border-color: #5c2d91; color: #5c2d91; }
  .export-btn.btn-rda:hover { background: #f0e8fa; }

  .export-btn.btn-csv { border-color: #1a6b1a; color: #1a6b1a; }
  .export-btn.btn-csv:hover { background: #e8fae8; }

  .export-btn.btn-copy { border-color: var(--border); color: var(--border); }
  .export-btn.btn-copy:hover { background: var(--gold-pale); }

  .export-btn.btn-reset { border-color: #555; color: #555; }
  .export-btn.btn-reset:hover { background: #f5f5f5; }

  /* Tabs for MARC/RDA view */
  .view-tabs {
    display: flex;
    border-bottom: 2px solid var(--parchment);
    margin-bottom: 16px;
    gap: 0;
  }

  .view-tab {
    padding: 8px 18px;
    font-family: 'Cairo', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    cursor: pointer;
    border: none;
    background: none;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
  }

  .view-tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  .technical-output {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 3px;
    padding: 14px 16px;
    font-family: 'Courier New', monospace;
    font-size: 0.82rem;
    line-height: 1.8;
    white-space: pre-wrap;
    direction: ltr;
    text-align: left;
    display: none;
    max-height: 280px;
    overflow-y: auto;
    color: #333;
  }

  .technical-output.active { display: block; }

  .card-view.active { display: block; }
  .card-view { display: none; }

  /* Footer */
  footer {
    text-align: center;
    margin-top: 40px;
    font-size: 0.78rem;
    color: var(--muted);
    font-family: 'Amiri', serif;
    letter-spacing: 0.5px;
  }

  footer .author-credit {
    font-weight: 700;
    color: var(--border);
  }

  /* Responsive */
  @media (max-width: 600px) {
    .field-row, .field-row.triple { grid-template-columns: 1fr; }
    .card-type-row { grid-template-columns: 1fr 1fr; }
    .export-grid { grid-template-columns: repeat(2, 1fr); }
    .form-body { padding: 20px 18px 16px; }
    .output-section { padding: 0 18px 24px; }
    .card-band { padding: 14px 18px; }
  }

  .new-card-btn {
    width: 100%;
    padding: 13px;
    background: linear-gradient(135deg, #b8860b 0%, #8b6914 100%);
    color: #fffdf7;
    border: none;
    border-radius: 3px;
    font-family: 'Cairo', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 1px;
    margin-bottom: 14px;
    transition: all 0.25s;
    box-shadow: 0 3px 12px rgba(184,134,11,0.3);
  }

  .new-card-btn:hover {
    background: linear-gradient(135deg, #d4a843 0%, #b8860b 100%);
    box-shadow: 0 5px 18px rgba(184,134,11,0.45);
    transform: translateY(-1px);
  }

  .new-card-btn:active { transform: scale(0.99); }

  /* Print */
  @media print {
    body { background: white; padding: 0; }
    .main-card { box-shadow: none; border: none; max-width: 100%; }
    .card-band, .form-body, .export-grid, .view-tabs, .output-label, .technical-output { display: none !important; }
    .output-section { display: block !important; padding: 0; }
    .catalog-card { box-shadow: none; }
  }
</style>
</head>
<body>

<header class="page-header">
  <span class="ornament">âœ¦ âœ¦ âœ¦</span>
  <h1 id="pageTitle">Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ©</h1>
  <p class="subtitle" id="pageSubtitle">ÙˆØµÙ Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠ Ù…ØªÙƒØ§Ù…Ù„ Â· MARC Â· RDA Â· ØªØµØ¯ÙŠØ± Word</p>
</header>

<div class="main-card">
  <div class="card-band">
    <span class="band-icon">ğŸ“š</span>
    <span class="band-title" id="bandTitle">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø±</span>
    <div class="lang-selector">
      <select id="language" onchange="changeLanguage()">
        <option value="ar">ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="en">ğŸŒ English</option>
      </select>
    </div>
  </div>

  <div class="form-body">

    <!-- Basic fields always shown -->
    <div class="section-title">
      <span class="sec-icon">ğŸ‘¤</span>
      <span id="secAuthors">Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ†</span>
    </div>

    <div class="field-row single field-group" style="margin-bottom:12px;">
      <label id="lblAuthor" for="author">Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
      <input type="text" id="author"/>
    </div>

    <div id="additionalAuthors"></div>

    <button class="add-author-btn" id="addAuthorBtn" onclick="addAuthorField()" type="button">
      <span>ï¼‹</span> <span id="addAuthorText">Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù„Ù Ù…Ø´Ø§Ø±Ùƒ</span>
    </button>

    <div class="divider"></div>

    <div class="section-title">
      <span class="sec-icon">ğŸ“–</span>
      <span id="secTitle">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Ø´Ø±</span>
    </div>

    <div class="field-row single field-group" style="margin-bottom:12px;">
      <label id="lblTitle" for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨</label>
      <input type="text" id="title"/>
    </div>

    <div class="field-row" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblSubtitle" for="subtitle">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ</label>
        <input type="text" id="subtitle" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"/>
      </div>
      <div class="field-group">
        <label id="lblEdition" for="edition">Ø§Ù„Ø·Ø¨Ø¹Ø©</label>
        <input type="text" id="edition"/>
      </div>
    </div>

    <div class="field-row" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblPubPlace" for="pubPlace">Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±</label>
        <input type="text" id="pubPlace"/>
      </div>
      <div class="field-group">
        <label id="lblPublisher" for="publisher">Ø§Ù„Ù†Ø§Ø´Ø± / Ø¯Ø§Ø± Ø§Ù„Ù†Ø´Ø±</label>
        <input type="text" id="publisher"/>
      </div>
    </div>

    <div class="field-row triple" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblPubDate" for="pubDate">Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø±</label>
        <input type="text" id="pubDate"/>
      </div>
      <div class="field-group">
        <label id="lblPages" for="pages">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</label>
        <input type="text" id="pages"/>
      </div>
      <div class="field-group">
        <label id="lblSeries" for="series">Ø§Ù„Ø³Ù„Ø³Ù„Ø©</label>
        <input type="text" id="series" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"/>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-title">
      <span class="sec-icon">ğŸ—‚ï¸</span>
      <span id="secCatalog">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ‡Ø±Ø³Ø©</span>
    </div>

    <div class="field-row" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblClassification" for="classification">Ø±Ù‚Ù… Ø§Ù„ØªØµÙ†ÙŠÙ (Ø¯ÙŠÙˆÙŠ)</label>
        <input type="text" id="classification" placeholder="Ù…Ø«Ø§Ù„: 025.3"/>
      </div>
      <div class="field-group">
        <label id="lblAuthorNumber" for="authorNumber">Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ù„Ù (ÙƒØªØ±)</label>
        <input type="text" id="authorNumber" placeholder="Ù…Ø«Ø§Ù„: Ø²889Ø¨"/>
      </div>
    </div>

    <div class="field-row" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblIsbn" for="isbn">Ø±Ø¯Ù…Ùƒ â€“ ISBN</label>
        <input type="text" id="isbn"/>
      </div>
      <div class="field-group">
        <label id="lblLegalDeposit" for="legalDeposit">Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</label>
        <input type="text" id="legalDeposit" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"/>
      </div>
    </div>

    <div class="field-row single" style="margin-bottom:12px;">
      <div class="field-group">
        <label id="lblSubjects" for="subjects">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)</label>
        <input type="text" id="subjects" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙÙ‡Ø±Ø³Ø©ØŒ Ø¹Ù„Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø§ØªØŒ Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠ"/>
      </div>
    </div>

    <div class="field-row single" style="margin-bottom:0;">
      <div class="field-group">
        <label id="lblNotes" for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <textarea id="notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-title">
      <span class="sec-icon">ğŸ—ƒï¸</span>
      <span id="secCardType">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
    </div>

    <div class="card-type-row" id="cardTypeRow">
      <button class="card-type-btn active" data-type="author" onclick="selectCardType(this)">
        <span class="type-icon">ğŸ‘¤</span>
        <span id="typeAuthorLabel">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¤Ù„Ù</span>
      </button>
      <button class="card-type-btn" data-type="title" onclick="selectCardType(this)">
        <span class="type-icon">ğŸ“–</span>
        <span id="typeTitleLabel">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span>
      </button>
      <button class="card-type-btn" data-type="subject" onclick="selectCardType(this)">
        <span class="type-icon">ğŸ·ï¸</span>
        <span id="typeSubjectLabel">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</span>
      </button>
    </div>

    <button class="generate-btn" onclick="generateCard()" id="generateBtn">
      âœ¦ &nbsp; ØªÙˆÙ„ÙŠØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© &nbsp; âœ¦
    </button>

  </div><!-- /form-body -->

  <!-- Output -->
  <div class="output-section" id="outputSection">

    <div class="divider" style="margin:0 0 20px;"></div>

    <div class="view-tabs">
      <button class="view-tab active" id="tab-card" onclick="switchTab('card')">
        ğŸƒ <span id="tabCardLabel">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø©</span>
      </button>
      <button class="view-tab" id="tab-marc" onclick="switchTab('marc')">
        ğŸ· MARC
      </button>
      <button class="view-tab" id="tab-rda" onclick="switchTab('rda')">
        ğŸ“‹ RDA
      </button>
    </div>

    <!-- Card view -->
    <div class="card-view active" id="view-card">
      <div class="catalog-card" id="catalogCard">
        <div class="call-number" id="cardCallNumber"></div>
        <div class="catalog-card-inner">
          <div class="main-entry" id="cardMainEntry"></div>
          <div class="description-area" id="cardDescription"></div>
          <div class="tracing" id="cardTracing"></div>
        </div>
        <div class="corner-mark" id="cardCornerMark"></div>
      </div>
    </div>

    <!-- MARC view -->
    <div id="view-marc">
      <div class="technical-output active" id="marcOutput"></div>
    </div>

    <!-- RDA view -->
    <div id="view-rda">
      <div class="technical-output active" id="rdaOutput"></div>
    </div>

    <!-- New Card button -->
    <button class="new-card-btn" onclick="resetForm()" id="newCardBtn">
      ï¼‹ &nbsp; Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
    </button>

    <!-- Export buttons -->
    <div class="export-grid">
      <button class="export-btn btn-word" onclick="exportToWord()">
        <span class="btn-icon">ğŸ“„</span>
        <span id="btnWord">ØªØµØ¯ÙŠØ± Word</span>
      </button>
      <button class="export-btn btn-marc" onclick="exportMARC()">
        <span class="btn-icon">ğŸ·</span>
        <span>ØªØµØ¯ÙŠØ± MARC</span>
      </button>
      <button class="export-btn btn-rda" onclick="exportRDA()">
        <span class="btn-icon">ğŸ“‹</span>
        <span>ØªØµØ¯ÙŠØ± RDA</span>
      </button>
      <button class="export-btn btn-csv" onclick="exportCSV()">
        <span class="btn-icon">ğŸ“Š</span>
        <span>ØªØµØ¯ÙŠØ± CSV</span>
      </button>
      <button class="export-btn btn-copy" onclick="copyCard()">
        <span class="btn-icon">ğŸ“‹</span>
        <span id="btnCopy">Ù†Ø³Ø® Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
      </button>
      <button class="export-btn btn-reset" onclick="resetForm()">
        <span class="btn-icon">ğŸ”„</span>
        <span id="btnReset">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</span>
      </button>
    </div>

  </div><!-- /output-section -->
</div><!-- /main-card -->

<footer>
  <span class="author-credit">Ø¯. Ø·Ù„Ø§Ù„ Ù†Ø§Ø¸Ù… Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ</span> &nbsp;Â·&nbsp; Ø£Ø¯Ø§Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ© &nbsp;Â·&nbsp; 2025 Â©
</footer>

<script>
/* ===========================
   STATE
=========================== */
let currentLang = 'ar';
let selectedCardType = 'author';
let currentCardData = {};

/* ===========================
   CARD TYPE SELECTION
=========================== */
function selectCardType(btn) {
  document.querySelectorAll('.card-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedCardType = btn.dataset.type;
}

/* ===========================
   AUTHOR FIELDS
=========================== */
let authorCount = 0;

function addAuthorField() {
  authorCount++;
  const container = document.getElementById('additionalAuthors');
  const row = document.createElement('div');
  row.className = 'extra-author-row';
  row.dataset.id = authorCount;

  const input = document.createElement('input');
  input.type = 'text';
  input.className = 'extra-author-input';
  input.placeholder = currentLang === 'ar' ? `Ù…Ø¤Ù„Ù Ù…Ø´Ø§Ø±Ùƒ ${authorCount + 1}` : `Co-author ${authorCount + 1}`;
  input.style.marginBottom = '0';

  const removeBtn = document.createElement('button');
  removeBtn.className = 'remove-author';
  removeBtn.textContent = 'âœ•';
  removeBtn.title = currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Remove';
  removeBtn.onclick = () => row.remove();

  row.appendChild(input);
  row.appendChild(removeBtn);
  container.appendChild(row);
}

/* ===========================
   GET FIELD VALUE
=========================== */
function g(id) {
  const el = document.getElementById(id);
  return el ? el.value.trim() : '';
}

/* ===========================
   FORMAT AUTHOR (Arabic/English inversion)
=========================== */
function formatAuthorEntry(name) {
  if (!name) return '';
  const parts = name.trim().split(/\s+/);
  if (currentLang === 'ar' && parts.length >= 2) {
    // Arabic: last name first with comma  Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±ØŒ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø§Ø³Ù…
    const last = parts[parts.length - 1];
    const rest = parts.slice(0, -1).join(' ');
    return `${last}ØŒ ${rest}`;
  } else if (currentLang === 'en' && parts.length >= 2) {
    // English: Last, First
    const last = parts[parts.length - 1];
    const rest = parts.slice(0, -1).join(' ');
    return `${last}, ${rest}`;
  }
  return name;
}

/* ===========================
   COLLECT ALL AUTHORS
=========================== */
function getAuthors() {
  const main = g('author');
  const extras = [];
  document.querySelectorAll('.extra-author-input').forEach(inp => {
    if (inp.value.trim()) extras.push(inp.value.trim());
  });
  return { main, extras, all: main ? [main, ...extras] : extras };
}

function buildAuthorsText(authorsArr) {
  const sep = currentLang === 'ar' ? 'ØŒ Ùˆ' : ', and ';
  const andLast = currentLang === 'ar' ? ' Ùˆ Ø¢Ø®Ø±ÙˆÙ†' : ' et al.';
  if (!authorsArr.length) return '';
  if (authorsArr.length === 1) return authorsArr[0];
  if (authorsArr.length === 2) return `${authorsArr[0]}${sep} ${authorsArr[1]}`;
  if (authorsArr.length === 3) return `${authorsArr[0]}ØŒ ${authorsArr[1]}${sep} ${authorsArr[2]}`;
  return `${authorsArr[0]}${andLast}`;
}

/* ===========================
   BUILD CARD DATA
=========================== */
function buildCardData() {
  const authors = getAuthors();
  const title = g('title');
  const subtitle = g('subtitle');
  const fullTitle = subtitle ? `${title} : ${subtitle}` : title;
  const edition = g('edition');
  const pubPlace = g('pubPlace');
  const publisher = g('publisher');
  const pubDate = g('pubDate');
  const pages = g('pages');
  const series = g('series');
  const subjects = g('subjects');
  const classification = g('classification');
  const authorNumber = g('authorNumber');
  const isbn = g('isbn');
  const legalDeposit = g('legalDeposit');
  const notes = g('notes');

  const callNumber = `${classification}${authorNumber ? '\n' + authorNumber : ''}`;
  const authorsText = buildAuthorsText(authors.all);

  // Build description line (ISBD style)
  let desc = '';
  desc += `${fullTitle} / ${authorsText}`;
  if (edition) desc += ` .- ${currentLang === 'ar' ? 'Ø·. ' : 'Ed. '}${edition}`;
  desc += ` .- ${pubPlace} : ${publisher}ØŒ ${pubDate}`;
  if (pages) desc += ` .- ${pages} ${currentLang === 'ar' ? 'Øµ.' : 'p.'}`;
  if (series) desc += `\n- (${series})`;

  // Main entry based on card type
  let mainEntry = '';
  const subjectsList = subjects.split(/[ØŒ,]/).map(s => s.trim()).filter(Boolean);
  if (selectedCardType === 'author') mainEntry = formatAuthorEntry(authors.main || authors.all[0] || '');
  else if (selectedCardType === 'title') mainEntry = fullTitle;
  else if (selectedCardType === 'subject') mainEntry = subjectsList[0] || '';

  return {
    callNumber, mainEntry, desc, authors, authorsText, fullTitle,
    edition, pubPlace, publisher, pubDate, pages, series,
    subjects: subjectsList, classification, authorNumber, isbn,
    legalDeposit, notes, title, subtitle
  };
}

/* ===========================
   GENERATE CARD (main)
=========================== */
function generateCard() {
  const authors = getAuthors();
  const title = g('title');

  if (!authors.main && !title) {
    alert(currentLang === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¤Ù„Ù Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.' : 'Please enter at least an author or title.');
    return;
  }

  currentCardData = buildCardData();
  renderCatalogCard(currentCardData);
  renderMARC(currentCardData);
  renderRDA(currentCardData);

  document.getElementById('outputSection').style.display = 'block';
  switchTab('card');
  document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

/* ===========================
   RENDER CATALOG CARD (visual)
=========================== */
function renderCatalogCard(d) {
  document.getElementById('cardCallNumber').innerHTML =
    d.classification ? `<div>${d.classification}</div><div>${d.authorNumber}</div>` : '';

  document.getElementById('cardMainEntry').textContent = d.mainEntry;

  let descHTML = '';
  const lines = d.desc.split('\n');
  lines.forEach((line, i) => {
    descHTML += `<span class="desc-line">${line}</span>`;
  });
  if (d.notes) descHTML += `<span class="desc-line" style="margin-top:6px;">${d.notes}</span>`;
  if (d.isbn) descHTML += `<span class="desc-line">Ø±Ø¯Ù…Ùƒ: ${d.isbn}</span>`;
  if (d.legalDeposit) descHTML += `<span class="desc-line">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹: ${d.legalDeposit}</span>`;
  document.getElementById('cardDescription').innerHTML = descHTML;

  // Tracing
  let tracingHTML = '';
  if (d.subjects.length) {
    d.subjects.forEach((s, i) => {
      tracingHTML += `<span class="tracing-item">${i + 1}. ${s}</span>`;
    });
  }
  if (d.authors.extras.length) {
    d.authors.extras.forEach(a => {
      tracingHTML += `<span class="tracing-item">Ù…: ${a}</span>`;
    });
  }
  const tracingEl = document.getElementById('cardTracing');
  tracingEl.innerHTML = tracingHTML;
  tracingEl.style.display = tracingHTML ? 'block' : 'none';

  document.getElementById('cardCornerMark').textContent =
    d.classification ? `${d.classification} ${d.authorNumber}` : '';
}

/* ===========================
   RENDER MARC
=========================== */
function renderMARC(d) {
  const a = d.authors;
  let marc = '';

  if (a.main) marc += `LDR    00000nam a2200000 i 4500\n`;
  marc += `001    [Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ·Ø±Ø©]\n`;
  marc += `003    [Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ø³Ø³Ø©]\n`;
  marc += `008    ${new Date().getFullYear().toString().slice(2)}    ` +
          `${d.pubPlace ? d.pubPlace.slice(0,2) : '--'} ` +
          `${currentLang === 'ar' ? 'ara' : 'eng'} ||||||||||||||||||00|\n`;

  if (d.isbn) marc += `020 __ $a ${d.isbn}\n`;
  if (d.classification) marc += `082 04 $a ${d.classification} $2 23\n`;
  if (d.classification) marc += `092 __ $a ${d.classification} $b ${d.authorNumber}\n`;

  if (a.main) marc += `100 1_ $a ${formatAuthorEntry(a.main)}ØŒ $e Ù…Ø¤Ù„Ù\n`;

  const titleInd2 = (d.title.startsWith('Ø§Ù„') || d.title.startsWith('Al-') || d.title.startsWith('The ')) ? '4' : '0';
  marc += `245 1${a.main ? '0' : '0'} $a ${d.title}`;
  if (d.subtitle) marc += ` $b ${d.subtitle} /`;
  marc += ` $c ${d.authorsText}\n`;

  if (d.edition) marc += `250 __ $a ${d.edition}\n`;
  marc += `264 _1 $a ${d.pubPlace} $b ${d.publisher} $c ${d.pubDate}\n`;
  if (d.pages) marc += `300 __ $a ${d.pages} ØµÙØ­Ø©\n`;
  if (d.series) marc += `490 1_ $a ${d.series}\n`;
  if (d.notes) marc += `500 __ $a ${d.notes}\n`;
  if (d.legalDeposit) marc += `037 __ $a ${d.legalDeposit}\n`;

  d.subjects.forEach((s, i) => {
    marc += `650 _4 $a ${s}\n`;
  });

  a.extras.forEach(auth => {
    marc += `700 1_ $a ${formatAuthorEntry(auth)}ØŒ $e Ù…Ø¤Ù„Ù Ù…Ø´Ø§Ø±Ùƒ\n`;
  });

  document.getElementById('marcOutput').textContent = marc.trim();
}

/* ===========================
   RENDER RDA
=========================== */
function renderRDA(d) {
  const a = d.authors;
  let rda = `â”€â”€ ÙˆØµÙ Ø§Ù„Ù…ØµØ¯Ø± ÙˆÙÙ‚ RDA (ØªÙˆØµÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„ÙˆØµÙˆÙ„) â”€â”€\n\n`;

  rda += `[ÙƒÙŠØ§Ù† Ø§Ù„Ø¹Ù…Ù„ / Work]\n`;
  rda += `  Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙØ¶Ù‘Ù„          : ${d.title}\n`;
  if (d.subtitle) rda += `  Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ          : ${d.subtitle}\n`;
  rda += `\n`;

  rda += `[ÙƒÙŠØ§Ù† Ø§Ù„ØªØ¹Ø¨ÙŠØ± / Expression]\n`;
  rda += `  Ù„ØºØ© Ø§Ù„ØªØ¹Ø¨ÙŠØ±             : ${currentLang === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English'}\n`;
  rda += `  Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰             : Ù†Øµ\n`;
  rda += `\n`;

  rda += `[ÙƒÙŠØ§Ù† Ø§Ù„Ù…Ø¸Ù‡Ø± / Manifestation]\n`;
  rda += `  Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ¹Ù„ÙŠ          : ${d.fullTitle}\n`;
  if (d.edition) rda += `  ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø·Ø¨Ø¹Ø©            : ${d.edition}\n`;
  rda += `  Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±              : ${d.pubPlace}\n`;
  rda += `  Ø§Ù„Ù†Ø§Ø´Ø±                  : ${d.publisher}\n`;
  rda += `  ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±             : ${d.pubDate}\n`;
  if (d.pages) rda += `  Ø­Ø¬Ù… Ø§Ù„ØªÙˆØ³Ù‘Ø¹             : ${d.pages} ØµÙØ­Ø©\n`;
  if (d.series) rda += `  Ø§Ù„Ø³Ù„Ø³Ù„Ø©                 : ${d.series}\n`;
  if (d.isbn) rda += `  Ø§Ù„Ù…Ø¹Ø±Ù‘Ù                 : ${d.isbn}\n`;
  if (d.legalDeposit) rda += `  Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹             : ${d.legalDeposit}\n`;
  if (d.notes) rda += `  Ù…Ù„Ø§Ø­Ø¸Ø§Øª                 : ${d.notes}\n`;
  rda += `  Ù†ÙˆØ¹ Ø§Ù„ÙˆØ³ÙŠØ·              : Ø¯ÙˆÙ† ÙˆØ³ÙŠØ·\n`;
  rda += `  Ù†ÙˆØ¹ Ø§Ù„Ù†Ø§Ù‚Ù„              : Ù…Ø¬Ù„Ø¯\n`;
  rda += `\n`;

  rda += `[ÙƒÙŠØ§Ù† Ø§Ù„Ø´Ø®Øµ / Person]\n`;
  if (a.main) rda += `  Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙØ¶Ù‘Ù„ (Ø§Ù„Ù…Ø¤Ù„Ù)  : ${formatAuthorEntry(a.main)}\n`;
  a.extras.forEach((auth, i) => {
    rda += `  Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ${i + 2}        : ${formatAuthorEntry(auth)}\n`;
  });
  rda += `\n`;

  rda += `[Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠØ©]\n`;
  d.subjects.forEach((s, i) => {
    rda += `  Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ${i + 1}               : ${s}\n`;
  });
  rda += `\n`;

  rda += `[Ø§Ù„ØªØµÙ†ÙŠÙ]\n`;
  rda += `  ØªØµÙ†ÙŠÙ Ø¯ÙŠÙˆÙŠ Ø§Ù„Ø¹Ø´Ø±ÙŠ       : ${d.classification}\n`;
  rda += `  Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ù„Ù (ÙƒØªØ±)        : ${d.authorNumber}\n`;

  document.getElementById('rdaOutput').textContent = rda.trim();
}

/* ===========================
   TAB SWITCHING
=========================== */
function switchTab(tab) {
  const tabs = ['card', 'marc', 'rda'];
  tabs.forEach(t => {
    const btn = document.getElementById(`tab-${t}`);
    const view = document.getElementById(`view-${t}`);
    if (btn) btn.classList.toggle('active', t === tab);
    if (view) view.style.display = t === tab ? 'block' : 'none';
  });
}

/* ===========================
   EXPORT: WORD (proper .docx-compatible HTML)
=========================== */
function exportToWord() {
  const d = currentCardData;
  if (!d.title && !d.authors.main) {
    alert(currentLang === 'ar' ? 'ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹.' : 'Please generate the card first.');
    return;
  }

  const tracingLines = [];
  if (d.subjects.length) {
    d.subjects.forEach((s, i) => tracingLines.push(`${i+1}. ${s}`));
  }
  if (d.authors.extras.length) {
    d.authors.extras.forEach(a => tracingLines.push(`Ù…: ${a}`));
  }

  const tracingHTML = tracingLines.length
    ? `<tr><td colspan="2" style="border-top:1px solid #999; padding-top:8pt; font-size:9pt; color:#555;">${tracingLines.join(' &nbsp;&nbsp; ')}</td></tr>`
    : '';

  const cornerMark = d.classification ? `${d.classification}${d.authorNumber ? '<br>' + d.authorNumber : ''}` : '';

  const wordHTML = `<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
      xmlns:w="urn:schemas-microsoft-com:office:word"
      xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta charset="UTF-8">
<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 15">
<meta name="Originator" content="Microsoft Word 15">
<!--[if gte mso 9]>
<xml>
  <w:WordDocument>
    <w:View>Print</w:View>
    <w:Zoom>100</w:Zoom>
    <w:DoNotOptimizeForBrowser/>
  </w:WordDocument>
</xml>
<![endif]-->
<style>
  @page {
    size: A4;
    margin: 2.5cm;
    mso-header-margin: 1cm;
    mso-footer-margin: 1cm;
  }
  body {
    font-family: "Traditional Arabic", "Simplified Arabic", Arial, sans-serif;
    font-size: 12pt;
    direction: rtl;
    margin: 0;
    padding: 0;
  }
  .page-title {
    text-align: center;
    font-size: 16pt;
    font-weight: bold;
    margin-bottom: 24pt;
    color: #1a3012;
    border-bottom: 2pt solid #1a3012;
    padding-bottom: 8pt;
  }
  .card-table {
    width: 100%;
    border-collapse: collapse;
    border: 2pt solid #000;
    font-family: "Traditional Arabic", Arial, sans-serif;
    font-size: 12pt;
    direction: rtl;
    margin-bottom: 18pt;
    page-break-inside: avoid;
  }
  .card-table td {
    padding: 6pt 10pt;
    vertical-align: top;
  }
  .call-cell {
    width: 65pt;
    border-left: 2pt solid #000;
    text-align: center;
    font-size: 11pt;
    font-weight: bold;
    vertical-align: middle;
    line-height: 1.6;
    border-bottom: 1pt solid #ccc;
    background: #f9f9f9;
  }
  .main-entry-cell {
    font-weight: bold;
    font-size: 12pt;
    padding-bottom: 4pt;
  }
  .desc-cell {
    font-size: 11pt;
    line-height: 1.8;
    padding-top: 2pt;
  }
  .tracing-row td {
    border-top: 1pt solid #aaa;
    font-size: 9.5pt;
    color: #444;
    padding-top: 6pt;
  }
  .label-row {
    font-size: 9pt;
    color: #666;
    font-weight: bold;
    padding: 4pt 10pt 0;
  }
  .field-row {
    margin-bottom: 8pt;
  }
  .field-label {
    font-weight: bold;
    color: #1a3012;
    margin-bottom: 2pt;
  }
  .section-heading {
    font-size: 13pt;
    font-weight: bold;
    color: #1a3012;
    border-bottom: 1pt solid #c0a040;
    padding-bottom: 4pt;
    margin: 20pt 0 12pt;
  }
</style>
</head>
<body>

<div class="page-title">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ©</div>

<!-- CATALOG CARD -->
<table class="card-table">
  <tr>
    <td class="call-cell" rowspan="3">${cornerMark}</td>
    <td class="main-entry-cell">${d.mainEntry}</td>
  </tr>
  <tr>
    <td class="desc-cell">${d.desc.replace(/\n/g, '<br/>')}</td>
  </tr>
  <tr>
    <td class="desc-cell">
      ${d.notes ? '<div>' + d.notes + '</div>' : ''}
      ${d.isbn ? '<div>Ø±Ø¯Ù…Ùƒ: ' + d.isbn + '</div>' : ''}
      ${d.legalDeposit ? '<div>Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹: ' + d.legalDeposit + '</div>' : ''}
    </td>
  </tr>
  ${tracingHTML}
</table>

<!-- DETAILED BIBLIOGRAPHIC DATA -->
<div class="section-heading">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</div>

<table style="width:100%; border-collapse:collapse; font-size:11pt; direction:rtl;">
  <tr>
    <td style="width:40%; padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</td>
    <td style="padding:5pt 8pt;">${d.authors.main || 'â€”'}</td>
  </tr>
  ${d.authors.extras.map((a, i) => `
  <tr>
    <td style="width:40%; padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ${i+2}</td>
    <td style="padding:5pt 8pt;">${a}</td>
  </tr>`).join('')}
  <tr style="background:#f5f0e8;">
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</td>
    <td style="padding:5pt 8pt;">${d.title}</td>
  </tr>
  ${d.subtitle ? `<tr><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ</td><td style="padding:5pt 8pt;">${d.subtitle}</td></tr>` : ''}
  ${d.edition ? `<tr><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ø·Ø¨Ø¹Ø©</td><td style="padding:5pt 8pt;">${d.edition}</td></tr>` : ''}
  <tr style="background:#f5f0e8;">
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±</td>
    <td style="padding:5pt 8pt;">${d.pubPlace || 'â€”'}</td>
  </tr>
  <tr>
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ù†Ø§Ø´Ø±</td>
    <td style="padding:5pt 8pt;">${d.publisher || 'â€”'}</td>
  </tr>
  <tr style="background:#f5f0e8;">
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø±</td>
    <td style="padding:5pt 8pt;">${d.pubDate || 'â€”'}</td>
  </tr>
  ${d.pages ? `<tr><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</td><td style="padding:5pt 8pt;">${d.pages} Øµ.</td></tr>` : ''}
  ${d.series ? `<tr style="background:#f5f0e8;"><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø§Ù„Ø³Ù„Ø³Ù„Ø©</td><td style="padding:5pt 8pt;">${d.series}</td></tr>` : ''}
  <tr>
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø±Ù‚Ù… Ø§Ù„ØªØµÙ†ÙŠÙ (Ø¯ÙŠÙˆÙŠ)</td>
    <td style="padding:5pt 8pt;">${d.classification || 'â€”'}</td>
  </tr>
  <tr style="background:#f5f0e8;">
    <td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ù„Ù (ÙƒØªØ±)</td>
    <td style="padding:5pt 8pt;">${d.authorNumber || 'â€”'}</td>
  </tr>
  ${d.isbn ? `<tr><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø±Ø¯Ù…Ùƒ (ISBN)</td><td style="padding:5pt 8pt;">${d.isbn}</td></tr>` : ''}
  ${d.legalDeposit ? `<tr style="background:#f5f0e8;"><td style="padding:5pt 8pt; font-weight:bold; color:#333;">Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</td><td style="padding:5pt 8pt;">${d.legalDeposit}</td></tr>` : ''}
  ${d.subjects.length ? `<tr><td style="padding:5pt 8pt; font-weight:bold; color:#333; vertical-align:top;">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª</td><td style="padding:5pt 8pt;">${d.subjects.join('<br/>')}</td></tr>` : ''}
  ${d.notes ? `<tr style="background:#f5f0e8;"><td style="padding:5pt 8pt; font-weight:bold; color:#333; vertical-align:top;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</td><td style="padding:5pt 8pt;">${d.notes}</td></tr>` : ''}
</table>

<br/>
<p style="font-size:9pt; color:#888; text-align:center; border-top:1pt solid #ddd; padding-top:8pt;">
  Ø£ÙØ¹Ø¯Ù‘Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø£Ø¯Ø§Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ© &nbsp;Â·&nbsp; Ø¯. Ø·Ù„Ø§Ù„ Ù†Ø§Ø¸Ù… Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ &nbsp;Â·&nbsp; ${new Date().getFullYear()}
</p>

</body>
</html>`;

  const blob = new Blob(['\uFEFF' + wordHTML], {
    type: 'application/vnd.ms-word;charset=utf-8'
  });
  downloadBlob(blob, 'Ø¨Ø·Ø§Ù‚Ø©_ÙÙ‡Ø±Ø³Ø©.doc');
}

/* ===========================
   EXPORT: MARC text file
=========================== */
function exportMARC() {
  const content = document.getElementById('marcOutput').textContent;
  const blob = new Blob(['\uFEFF' + content], { type: 'text/plain;charset=utf-8' });
  downloadBlob(blob, 'marc_record.txt');
}

/* ===========================
   EXPORT: RDA text file
=========================== */
function exportRDA() {
  const content = document.getElementById('rdaOutput').textContent;
  const blob = new Blob(['\uFEFF' + content], { type: 'text/plain;charset=utf-8' });
  downloadBlob(blob, 'rda_record.txt');
}

/* ===========================
   EXPORT: CSV
=========================== */
function exportCSV() {
  const d = currentCardData;
  const headers = ['Ø§Ù„Ù…Ø¤Ù„Ù','Ø§Ù„Ø¹Ù†ÙˆØ§Ù†','Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ','Ø§Ù„Ø·Ø¨Ø¹Ø©','Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±','Ø§Ù„Ù†Ø§Ø´Ø±',
                   'Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø±','Ø§Ù„ØµÙØ­Ø§Øª','Ø§Ù„Ø³Ù„Ø³Ù„Ø©','Ø±Ù‚Ù… Ø§Ù„ØªØµÙ†ÙŠÙ','Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ù„Ù',
                   'Ø±Ø¯Ù…Ùƒ','Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹','Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª','Ù…Ù„Ø§Ø­Ø¸Ø§Øª'];
  const values = [
    d.authors.main, d.title, d.subtitle, d.edition,
    d.pubPlace, d.publisher, d.pubDate, d.pages,
    d.series, d.classification, d.authorNumber,
    d.isbn, d.legalDeposit, d.subjects.join('Ø› '), d.notes
  ];

  const escape = v => `"${(v || '').replace(/"/g, '""')}"`;
  const csv = `\uFEFF${headers.map(escape).join(',')}\n${values.map(escape).join(',')}`;
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
  downloadBlob(blob, 'Ø¨Ø·Ø§Ù‚Ø©_ÙÙ‡Ø±Ø³Ø©.csv');
}

/* ===========================
   COPY CARD TEXT
=========================== */
function copyCard() {
  const d = currentCardData;
  const text = `${d.callNumber}\n${d.mainEntry}\n\n${d.desc}` +
    (d.notes ? `\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª: ${d.notes}` : '') +
    (d.isbn ? `\nØ±Ø¯Ù…Ùƒ: ${d.isbn}` : '') +
    (d.legalDeposit ? `\nØ§Ù„Ø¥ÙŠØ¯Ø§Ø¹: ${d.legalDeposit}` : '') +
    (d.subjects.length ? '\n' + d.subjects.map((s,i)=>`${i+1}. ${s}`).join('  ') : '');

  navigator.clipboard.writeText(text).then(() => {
    alert(currentLang === 'ar' ? 'âœ“ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.' : 'âœ“ Card copied to clipboard.');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    alert(currentLang === 'ar' ? 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®.' : 'âœ“ Copied.');
  });
}

/* ===========================
   RESET
=========================== */
function resetForm() {
  // Clear all fields EXCEPT subjects and notes
  const preserveIds = ['subjects', 'notes'];
  document.querySelectorAll('input[type="text"], textarea').forEach(el => {
    if (!preserveIds.includes(el.id)) el.value = '';
  });
  document.getElementById('additionalAuthors').innerHTML = '';
  document.getElementById('outputSection').style.display = 'none';
  authorCount = 0;
  currentCardData = {};
  // Reset card type to author
  document.querySelectorAll('.card-type-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.card-type-btn[data-type="author"]').classList.add('active');
  selectedCardType = 'author';
  // Focus on first field
  document.getElementById('author').focus();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ===========================
   HELPER: Download blob
=========================== */
function downloadBlob(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  setTimeout(() => URL.revokeObjectURL(url), 10000);
}

/* ===========================
   LANGUAGE SWITCH
=========================== */
const LABELS = {
  ar: {
    pageTitle: 'Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø© Ø§Ù„Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠØ©',
    pageSubtitle: 'ÙˆØµÙ Ø¨Ø¨Ù„ÙŠÙˆØºØ±Ø§ÙÙŠ Ù…ØªÙƒØ§Ù…Ù„ Â· MARC Â· RDA Â· ØªØµØ¯ÙŠØ± Word',
    bandTitle: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø±',
    secAuthors: 'Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ†',
    secTitle: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Ø´Ø±',
    secCatalog: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ‡Ø±Ø³Ø©',
    secCardType: 'Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
    lblAuthor: 'Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
    lblTitle: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨',
    lblSubtitle: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ',
    lblEdition: 'Ø§Ù„Ø·Ø¨Ø¹Ø©',
    lblPubPlace: 'Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±',
    lblPublisher: 'Ø§Ù„Ù†Ø§Ø´Ø± / Ø¯Ø§Ø± Ø§Ù„Ù†Ø´Ø±',
    lblPubDate: 'Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø±',
    lblPages: 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª',
    lblSeries: 'Ø§Ù„Ø³Ù„Ø³Ù„Ø©',
    lblClassification: 'Ø±Ù‚Ù… Ø§Ù„ØªØµÙ†ÙŠÙ (Ø¯ÙŠÙˆÙŠ)',
    lblAuthorNumber: 'Ø±Ù…Ø² Ø§Ù„Ù…Ø¤Ù„Ù (ÙƒØªØ±)',
    lblIsbn: 'Ø±Ø¯Ù…Ùƒ â€“ ISBN',
    lblLegalDeposit: 'Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ',
    lblSubjects: 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)',
    lblNotes: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
    typeAuthorLabel: 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¤Ù„Ù',
    typeTitleLabel: 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
    typeSubjectLabel: 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹',
    addAuthorText: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù„Ù Ù…Ø´Ø§Ø±Ùƒ',
    generateBtn: 'âœ¦   ØªÙˆÙ„ÙŠØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø©   âœ¦',
    tabCardLabel: 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ‡Ø±Ø³Ø©',
    btnWord: 'ØªØµØ¯ÙŠØ± Word',
    btnCopy: 'Ù†Ø³Ø® Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
    btnReset: 'Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',
    newCardBtn: 'ï¼‹   Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©',
  },
  en: {
    pageTitle: 'Bibliographic Catalog Card Tool',
    pageSubtitle: 'Complete Bibliographic Description Â· MARC Â· RDA Â· Word Export',
    bandTitle: 'Source Data',
    secAuthors: 'Authors',
    secTitle: 'Title & Publication',
    secCatalog: 'Cataloging Data',
    secCardType: 'Card Type',
    lblAuthor: 'Main Author',
    lblTitle: 'Book Title',
    lblSubtitle: 'Subtitle',
    lblEdition: 'Edition',
    lblPubPlace: 'Place of Publication',
    lblPublisher: 'Publisher',
    lblPubDate: 'Publication Year',
    lblPages: 'Number of Pages',
    lblSeries: 'Series',
    lblClassification: 'Classification (Dewey)',
    lblAuthorNumber: 'Author Number (Cutter)',
    lblIsbn: 'ISBN',
    lblLegalDeposit: 'Legal Deposit No.',
    lblSubjects: 'Subjects (comma-separated)',
    lblNotes: 'Notes',
    typeAuthorLabel: 'Author Card',
    typeTitleLabel: 'Title Card',
    typeSubjectLabel: 'Subject Card',
    addAuthorText: 'Add Co-author',
    generateBtn: 'âœ¦   Generate Catalog Card   âœ¦',
    tabCardLabel: 'Catalog Card',
    btnWord: 'Export Word',
    btnCopy: 'Copy Card',
    btnReset: 'Clear All',
    newCardBtn: 'ï¼‹   New Card',
  }
};

function changeLanguage() {
  currentLang = document.getElementById('language').value;
  const L = LABELS[currentLang];
  const isAr = currentLang === 'ar';

  document.documentElement.lang = currentLang;
  document.documentElement.dir = isAr ? 'rtl' : 'ltr';
  document.body.style.direction = isAr ? 'rtl' : 'ltr';

  for (const [id, text] of Object.entries(L)) {
    const el = document.getElementById(id);
    if (el) {
      if (el.tagName === 'BUTTON') el.textContent = text;
      else el.textContent = text;
    }
  }

  // Update author placeholder
  document.getElementById('author').placeholder = isAr ? 'Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡' : 'e.g. John Michael Smith';
}

/* Init tab visibility */
switchTab('card');
</script>

</body>
</html>
